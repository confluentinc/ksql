{
  "comments": [
    "You can specify multiple statements per test case, i.e., to set up the various streams needed",
    "for joins etc, but currently only the final topology will be verified. This should be enough",
    "for most tests as we can simulate the outputs from previous stages into the final stage. If we",
    "take a modular approach to testing we can still verify that it all works correctly, i.e, if we",
    "verify the output of a select or aggregate is correct, we can use simulated output to feed into",
    "a join or another aggregate.",
    "This test run queries on a stream with super nested schema. It will test different struct types and how queries can access nested fields in structs."
  ],
  "tests": [
    {
      "format": ["AVRO", "JSON"],
      "statements": [
        "CREATE STREAM orders (ordertime bigint, orderid bigint, itemid STRUCT< ITEMID BIGINT, NAME VARCHAR, CATEGORY STRUCT< ID BIGINT, NAME VARCHAR>>, ORDERUNITS double, ARRAYCOL array<double>, MAPCOL map<varchar, double>, address STRUCT < number bigint, street varchar, city varchar, state varchar, zipcode bigint>) WITH (kafka_topic='test_topic', key='orderid', value_format='{FORMAT}');",
        "CREATE STREAM s1 AS SELECT * FROM orders;"
      ],
      "name": "simple struct select star",
      "inputs": [
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 1,
            "ITEMID": {
              "ITEMID": 6,
              "CATEGORY": {
                "ID": 2,
                "NAME": "Food"
              },
              "NAME": "Item_6"
            },
            "ORDERTIME": 1528224275715,
            "MAPCOL": {
              "key3": 3.8688222734507915,
              "key2": 5.878674158377773,
              "key1": 2.706938954083115
            },
            "ORDERUNITS": 2.0,
            "ADDRESS": {
              "CITY": "CITY_0",
              "STATE": "STATE_1",
              "STREET": "STREET_4",
              "NUMBER": 376,
              "ZIPCODE": 621
            },
            "ARRAYCOL": [
              6.27276558443913,
              8.720822816653817,
              4.904955205015469,
              0.28466518164817933,
              5.276269704236784
            ]
          },
          "key": "0"
        },
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 2,
            "ITEMID": {
              "ITEMID": 6,
              "CATEGORY": {
                "ID": 2,
                "NAME": "Produce"
              },
              "NAME": "Item_6"
            },
            "ORDERTIME": 1528224280668,
            "MAPCOL": {
              "key3": 0.08025583241041634,
              "key2": 7.886688738692968,
              "key1": 7.997268326700826
            },
            "ORDERUNITS": 4.0,
            "ADDRESS": {
              "CITY": "CITY_3",
              "STATE": "STATE_6",
              "STREET": "STREET_5",
              "NUMBER": 29,
              "ZIPCODE": 46
            },
            "ARRAYCOL": [
              5.028181423106411,
              4.223556791057725,
              7.503771637501132,
              1.8346470572995977,
              8.628168574256188
            ]
          },
          "key": "100"
        },
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 3,
            "ITEMID": {
              "ITEMID": 6,
              "CATEGORY": {
                "ID": 2,
                "NAME": "Produce"
              },
              "NAME": "Item_6"
            },
            "ORDERTIME": 1528224281566,
            "MAPCOL": {
              "key3": 8.232202829012866,
              "key2": 4.76749034853443,
              "key1": 3.908548556676262
            },
            "ORDERUNITS": 6.0,
            "ADDRESS": {
              "CITY": "CITY_9",
              "STATE": "STATE_9",
              "STREET": "STREET_3",
              "NUMBER": 219,
              "ZIPCODE": 287
            },
            "ARRAYCOL": [
              9.404053021473551,
              2.005832055529364,
              0.16252060679229574,
              8.030440873506674,
              2.6822009490877683
            ]
          },
          "key": "101"
        },
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 4,
            "ITEMID": {
              "ITEMID": 2,
              "CATEGORY": {
                "ID": 1,
                "NAME": "Food"
              },
              "NAME": "Item_2"
            },
            "ORDERTIME": 1528224285603,
            "MAPCOL": {
              "key3": 8.58507015716884,
              "key2": 8.690191464522353,
              "key1": 3.966253991851106
            },
            "ORDERUNITS": 3.0,
            "ADDRESS": {
              "CITY": "CITY_3",
              "STATE": "STATE_5",
              "STREET": "STREET_8",
              "NUMBER": 380,
              "ZIPCODE": 866
            },
            "ARRAYCOL": [
              9.887072401304447,
              5.217021497196517,
              5.604857288119519,
              4.628527278923561,
              6.367135367927281
            ]
          },
          "key": "101"
        },
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 5,
            "ITEMID": {
              "ITEMID": 5,
              "CATEGORY": {
                "ID": 1,
                "NAME": "Produce"
              },
              "NAME": "Item_5"
            },
            "ORDERTIME": 1528224286568,
            "MAPCOL": {
              "key3": 4.9160189684727,
              "key2": 1.3876747586974092,
              "key1": 6.688854425726891
            },
            "ORDERUNITS": 5.0,
            "ADDRESS": {
              "CITY": "CITY_6",
              "STATE": "STATE_3",
              "STREET": "STREET_8",
              "NUMBER": 294,
              "ZIPCODE": 724
            },
            "ARRAYCOL": [
              1.6856668854084866,
              3.4970511301361484,
              9.143163282671962,
              2.196065628133206,
              4.343961390870502
            ]
          },
          "key": "101"
        }
      ],
      "outputs": [
        {
          "topic": "S1",
          "timestamp": 0,
          "value": {
            "ORDERID": 1,
            "ITEMID": {
              "ITEMID": 6,
              "CATEGORY": {
                "ID": 2,
                "NAME": "Food"
              },
              "NAME": "Item_6"
            },
            "ORDERTIME": 1528224275715,
            "MAPCOL": {
              "key3": 3.8688222734507915,
              "key2": 5.878674158377773,
              "key1": 2.706938954083115
            },
            "ORDERUNITS": 2.0,
            "ADDRESS": {
              "CITY": "CITY_0",
              "STATE": "STATE_1",
              "STREET": "STREET_4",
              "NUMBER": 376,
              "ZIPCODE": 621
            },
            "ARRAYCOL": [
              6.27276558443913,
              8.720822816653817,
              4.904955205015469,
              0.28466518164817933,
              5.276269704236784
            ]
          },
          "key": "0"
        },
        {
          "topic": "S1",
          "timestamp": 0,
          "value": {
            "ORDERID": 2,
            "ITEMID": {
              "ITEMID": 6,
              "CATEGORY": {
                "ID": 2,
                "NAME": "Produce"
              },
              "NAME": "Item_6"
            },
            "ORDERTIME": 1528224280668,
            "MAPCOL": {
              "key3": 0.08025583241041634,
              "key2": 7.886688738692968,
              "key1": 7.997268326700826
            },
            "ORDERUNITS": 4.0,
            "ADDRESS": {
              "CITY": "CITY_3",
              "STATE": "STATE_6",
              "STREET": "STREET_5",
              "NUMBER": 29,
              "ZIPCODE": 46
            },
            "ARRAYCOL": [
              5.028181423106411,
              4.223556791057725,
              7.503771637501132,
              1.8346470572995977,
              8.628168574256188
            ]
          },
          "key": "100"
        },
        {
          "topic": "S1",
          "timestamp": 0,
          "value": {
            "ORDERID": 3,
            "ITEMID": {
              "ITEMID": 6,
              "CATEGORY": {
                "ID": 2,
                "NAME": "Produce"
              },
              "NAME": "Item_6"
            },
            "ORDERTIME": 1528224281566,
            "MAPCOL": {
              "key3": 8.232202829012866,
              "key2": 4.76749034853443,
              "key1": 3.908548556676262
            },
            "ORDERUNITS": 6.0,
            "ADDRESS": {
              "CITY": "CITY_9",
              "STATE": "STATE_9",
              "STREET": "STREET_3",
              "NUMBER": 219,
              "ZIPCODE": 287
            },
            "ARRAYCOL": [
              9.404053021473551,
              2.005832055529364,
              0.16252060679229574,
              8.030440873506674,
              2.6822009490877683
            ]
          },
          "key": "101"
        },
        {
          "topic": "S1",
          "timestamp": 0,
          "value": {
            "ORDERID": 4,
            "ITEMID": {
              "ITEMID": 2,
              "CATEGORY": {
                "ID": 1,
                "NAME": "Food"
              },
              "NAME": "Item_2"
            },
            "ORDERTIME": 1528224285603,
            "MAPCOL": {
              "key3": 8.58507015716884,
              "key2": 8.690191464522353,
              "key1": 3.966253991851106
            },
            "ORDERUNITS": 3.0,
            "ADDRESS": {
              "CITY": "CITY_3",
              "STATE": "STATE_5",
              "STREET": "STREET_8",
              "NUMBER": 380,
              "ZIPCODE": 866
            },
            "ARRAYCOL": [
              9.887072401304447,
              5.217021497196517,
              5.604857288119519,
              4.628527278923561,
              6.367135367927281
            ]
          },
          "key": "101"
        },
        {
          "topic": "S1",
          "timestamp": 0,
          "value": {
            "ORDERID": 5,
            "ITEMID": {
              "ITEMID": 5,
              "CATEGORY": {
                "ID": 1,
                "NAME": "Produce"
              },
              "NAME": "Item_5"
            },
            "ORDERTIME": 1528224286568,
            "MAPCOL": {
              "key3": 4.9160189684727,
              "key2": 1.3876747586974092,
              "key1": 6.688854425726891
            },
            "ORDERUNITS": 5.0,
            "ADDRESS": {
              "CITY": "CITY_6",
              "STATE": "STATE_3",
              "STREET": "STREET_8",
              "NUMBER": 294,
              "ZIPCODE": 724
            },
            "ARRAYCOL": [
              1.6856668854084866,
              3.4970511301361484,
              9.143163282671962,
              2.196065628133206,
              4.343961390870502
            ]
          },
          "key": "101"
        }
      ]
    },
    {
      "format": ["JSON"],
      "statements": [
        "CREATE STREAM orders (ordertime bigint, orderid bigint, itemid VARCHAR, ORDERUNITS double, ARRAYCOL array<double>, MAPCOL map<varchar, double>, address STRUCT < number bigint, street varchar, city varchar, state varchar, zipcode bigint>) WITH (kafka_topic='test_topic', key='orderid', value_format='{FORMAT}');",
        "CREATE STREAM s1 AS SELECT itemid, EXTRACTJSONFIELD(itemid, '$.ITEMID') FROM orders;"
      ],
      "name": "simple struct read struct as json string",
      "inputs": [
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 1,
            "ITEMID": {
              "ITEMID": 6,
              "CATEGORY": {
                "ID": 2,
                "NAME": "Food"
              },
              "NAME": "Item_6"
            },
            "ORDERTIME": 1528224275715,
            "MAPCOL": {
              "key3": 3.8688222734507915,
              "key2": 5.878674158377773,
              "key1": 2.706938954083115
            },
            "ORDERUNITS": 2.0,
            "ADDRESS": {
              "CITY": "CITY_0",
              "STATE": "STATE_1",
              "STREET": "STREET_4",
              "NUMBER": 376,
              "ZIPCODE": 621
            },
            "ARRAYCOL": [
              6.27276558443913,
              8.720822816653817,
              4.904955205015469,
              0.28466518164817933,
              5.276269704236784
            ]
          },
          "key": "0"
        },
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 2,
            "ITEMID": {
              "ITEMID": 6,
              "CATEGORY": {
                "ID": 2,
                "NAME": "Produce"
              },
              "NAME": "Item_6"
            },
            "ORDERTIME": 1528224280668,
            "MAPCOL": {
              "key3": 0.08025583241041634,
              "key2": 7.886688738692968,
              "key1": 7.997268326700826
            },
            "ORDERUNITS": 4.0,
            "ADDRESS": {
              "CITY": "CITY_3",
              "STATE": "STATE_6",
              "STREET": "STREET_5",
              "NUMBER": 29,
              "ZIPCODE": 46
            },
            "ARRAYCOL": [
              5.028181423106411,
              4.223556791057725,
              7.503771637501132,
              1.8346470572995977,
              8.628168574256188
            ]
          },
          "key": "100"
        },
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 3,
            "ITEMID": {
              "ITEMID": 6,
              "CATEGORY": {
                "ID": 2,
                "NAME": "Produce"
              },
              "NAME": "Item_6"
            },
            "ORDERTIME": 1528224281566,
            "MAPCOL": {
              "key3": 8.232202829012866,
              "key2": 4.76749034853443,
              "key1": 3.908548556676262
            },
            "ORDERUNITS": 6.0,
            "ADDRESS": {
              "CITY": "CITY_9",
              "STATE": "STATE_9",
              "STREET": "STREET_3",
              "NUMBER": 219,
              "ZIPCODE": 287
            },
            "ARRAYCOL": [
              9.404053021473551,
              2.005832055529364,
              0.16252060679229574,
              8.030440873506674,
              2.6822009490877683
            ]
          },
          "key": "101"
        },
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 4,
            "ITEMID": {
              "ITEMID": 2,
              "CATEGORY": {
                "ID": 1,
                "NAME": "Food"
              },
              "NAME": "Item_2"
            },
            "ORDERTIME": 1528224285603,
            "MAPCOL": {
              "key3": 8.58507015716884,
              "key2": 8.690191464522353,
              "key1": 3.966253991851106
            },
            "ORDERUNITS": 3.0,
            "ADDRESS": {
              "CITY": "CITY_3",
              "STATE": "STATE_5",
              "STREET": "STREET_8",
              "NUMBER": 380,
              "ZIPCODE": 866
            },
            "ARRAYCOL": [
              9.887072401304447,
              5.217021497196517,
              5.604857288119519,
              4.628527278923561,
              6.367135367927281
            ]
          },
          "key": "101"
        },
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 5,
            "ITEMID": {
              "ITEMID": 5,
              "CATEGORY": {
                "ID": 1,
                "NAME": "Produce"
              },
              "NAME": "Item_5"
            },
            "ORDERTIME": 1528224286568,
            "MAPCOL": {
              "key3": 4.9160189684727,
              "key2": 1.3876747586974092,
              "key1": 6.688854425726891
            },
            "ORDERUNITS": 5.0,
            "ADDRESS": {
              "CITY": "CITY_6",
              "STATE": "STATE_3",
              "STREET": "STREET_8",
              "NUMBER": 294,
              "ZIPCODE": 724
            },
            "ARRAYCOL": [
              1.6856668854084866,
              3.4970511301361484,
              9.143163282671962,
              2.196065628133206,
              4.343961390870502
            ]
          },
          "key": "101"
        }
      ],
      "outputs": [
        {
          "topic": "S1",
          "timestamp": 0,
          "value": {
            "ITEMID": "{\"CATEGORY\":{\"ID\":2,\"NAME\":\"Food\"},\"ITEMID\":6,\"NAME\":\"Item_6\"}",
            "KSQL_COL_1": "6"
          },
          "key": "0"
        },
        {
          "topic": "S1",
          "timestamp": 0,
          "value": {
            "ITEMID": "{\"CATEGORY\":{\"ID\":2,\"NAME\":\"Produce\"},\"ITEMID\":6,\"NAME\":\"Item_6\"}",
            "KSQL_COL_1": "6"
          },
          "key": "100"
        },
        {
          "topic": "S1",
          "timestamp": 0,
          "value": {
            "ITEMID": "{\"CATEGORY\":{\"ID\":2,\"NAME\":\"Produce\"},\"ITEMID\":6,\"NAME\":\"Item_6\"}",
            "KSQL_COL_1": "6"
          },
          "key": "101"
        },
        {
          "topic": "S1",
          "timestamp": 0,
          "value": {
            "ITEMID": "{\"CATEGORY\":{\"ID\":1,\"NAME\":\"Food\"},\"ITEMID\":2,\"NAME\":\"Item_2\"}",
            "KSQL_COL_1": "2"
          },
          "key": "101"
        },
        {
          "topic": "S1",
          "timestamp": 0,
          "value": {
            "ITEMID":  "{\"CATEGORY\":{\"ID\":1,\"NAME\":\"Produce\"},\"ITEMID\":5,\"NAME\":\"Item_5\"}",
            "KSQL_COL_1": "5"
          },
          "key": "101"
        }
      ]
    },
    {
      "name": "simple struct select filter",
      "format": ["AVRO", "JSON"],
      "statements": [
        "CREATE STREAM orders (ordertime bigint, orderid bigint, itemid STRUCT< ITEMID BIGINT, NAME VARCHAR, CATEGORY STRUCT< ID BIGINT, NAME VARCHAR>>, ORDERUNITS double, ARRAYCOL array<double>, MAPCOL map<varchar, double>, address STRUCT < number bigint, street varchar, city varchar, state varchar, zipcode bigint>) WITH (kafka_topic='test_topic', key='orderid', value_format='{FORMAT}');",
        "CREATE STREAM S2 AS SELECT itemid->name FROM orders where itemid->name = 'Item_6';"
      ],
      "inputs": [
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 1,
            "ITEMID": {
              "ITEMID": 6,
              "CATEGORY": {
                "ID": 2,
                "NAME": "Food"
              },
              "NAME": "Item_6"
            },
            "ORDERTIME": 1528224275715,
            "MAPCOL": {
              "key3": 3.8688222734507915,
              "key2": 5.878674158377773,
              "key1": 2.706938954083115
            },
            "ORDERUNITS": 2,
            "ADDRESS": {
              "CITY": "CITY_0",
              "STATE": "STATE_1",
              "STREET": "STREET_4",
              "NUMBER": 376,
              "ZIPCODE": 621
            },
            "ARRAYCOL": [
              6.27276558443913,
              8.720822816653817,
              4.904955205015469,
              0.28466518164817933,
              5.276269704236784
            ]
          },
          "key": "0"
        },
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 2,
            "ITEMID": {
              "ITEMID": 6,
              "CATEGORY": {
                "ID": 2,
                "NAME": "Produce"
              },
              "NAME": "Item_6"
            },
            "ORDERTIME": 1528224280668,
            "MAPCOL": {
              "key3": 0.08025583241041634,
              "key2": 7.886688738692968,
              "key1": 7.997268326700826
            },
            "ORDERUNITS": 4,
            "ADDRESS": {
              "CITY": "CITY_3",
              "STATE": "STATE_6",
              "STREET": "STREET_5",
              "NUMBER": 29,
              "ZIPCODE": 46
            },
            "ARRAYCOL": [
              5.028181423106411,
              4.223556791057725,
              7.503771637501132,
              1.8346470572995977,
              8.628168574256188
            ]
          },
          "key": "100"
        },
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 3,
            "ITEMID": {
              "ITEMID": 6,
              "CATEGORY": {
                "ID": 2,
                "NAME": "Produce"
              },
              "NAME": "Item_6"
            },
            "ORDERTIME": 1528224281566,
            "MAPCOL": {
              "key3": 8.232202829012866,
              "key2": 4.76749034853443,
              "key1": 3.908548556676262
            },
            "ORDERUNITS": 6,
            "ADDRESS": {
              "CITY": "CITY_9",
              "STATE": "STATE_9",
              "STREET": "STREET_3",
              "NUMBER": 219,
              "ZIPCODE": 287
            },
            "ARRAYCOL": [
              9.404053021473551,
              2.005832055529364,
              0.16252060679229574,
              8.030440873506674,
              2.6822009490877683
            ]
          },
          "key": "101"
        },
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 4,
            "ITEMID": {
              "ITEMID": 2,
              "CATEGORY": {
                "ID": 1,
                "NAME": "Food"
              },
              "NAME": "Item_2"
            },
            "ORDERTIME": 1528224285603,
            "MAPCOL": {
              "key3": 8.58507015716884,
              "key2": 8.690191464522353,
              "key1": 3.966253991851106
            },
            "ORDERUNITS": 3,
            "ADDRESS": {
              "CITY": "CITY_3",
              "STATE": "STATE_5",
              "STREET": "STREET_8",
              "NUMBER": 380,
              "ZIPCODE": 866
            },
            "ARRAYCOL": [
              9.887072401304447,
              5.217021497196517,
              5.604857288119519,
              4.628527278923561,
              6.367135367927281
            ]
          },
          "key": "101"
        },
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 5,
            "ITEMID": {
              "ITEMID": 5,
              "CATEGORY": {
                "ID": 1,
                "NAME": "Produce"
              },
              "NAME": "Item_5"
            },
            "ORDERTIME": 1528224286568,
            "MAPCOL": {
              "key3": 4.9160189684727,
              "key2": 1.3876747586974092,
              "key1": 6.688854425726891
            },
            "ORDERUNITS": 5,
            "ADDRESS": {
              "CITY": "CITY_6",
              "STATE": "STATE_3",
              "STREET": "STREET_8",
              "NUMBER": 294,
              "ZIPCODE": 724
            },
            "ARRAYCOL": [
              1.6856668854084866,
              3.4970511301361484,
              9.143163282671962,
              2.196065628133206,
              4.343961390870502
            ]
          },
          "key": "101"
        }
      ],
      "outputs": [
        {
          "topic": "S2",
          "timestamp": 0,
          "value": {
            "ITEMID__NAME": "Item_6"
          },
          "key": "0"
        },
        {
          "topic": "S2",
          "timestamp": 0,
          "value": {
            "ITEMID__NAME": "Item_6"
          },
          "key": "100"
        },
        {
          "topic": "S2",
          "timestamp": 0,
          "value": {
            "ITEMID__NAME": "Item_6"
          },
          "key": "101"
        }
      ]
    },
    {
      "name": "simple struct select filter 2",
      "format": ["AVRO", "JSON"],
      "statements": [
        "CREATE STREAM orders (ordertime bigint, orderid bigint, itemid STRUCT< ITEMID BIGINT, NAME VARCHAR, CATEGORY STRUCT< ID BIGINT, NAME VARCHAR>>, ORDERUNITS double, ARRAYCOL array<double>, MAPCOL map<varchar, double>, address STRUCT < number bigint, street varchar, city varchar, state varchar, zipcode bigint>) WITH (kafka_topic='test_topic', key='orderid', value_format='{FORMAT}');",
        "CREATE STREAM S3 AS SELECT itemid->category->id, address->street , address->zipcode as zipcode, address->state as state FROM orders WHERE address->state LIKE '%_9';"
      ],
      "inputs": [
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 1,
            "ITEMID": {
              "ITEMID": 6,
              "CATEGORY": {
                "ID": 2,
                "NAME": "Food"
              },
              "NAME": "Item_6"
            },
            "ORDERTIME": 1528224275715,
            "MAPCOL": {
              "key3": 3.8688222734507915,
              "key2": 5.878674158377773,
              "key1": 2.706938954083115
            },
            "ORDERUNITS": 2,
            "ADDRESS": {
              "CITY": "CITY_0",
              "STATE": "STATE_1",
              "STREET": "STREET_4",
              "NUMBER": 376,
              "ZIPCODE": 621
            },
            "ARRAYCOL": [
              6.27276558443913,
              8.720822816653817,
              4.904955205015469,
              0.28466518164817933,
              5.276269704236784
            ]
          },
          "key": "0"
        },
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 2,
            "ITEMID": {
              "ITEMID": 6,
              "CATEGORY": {
                "ID": 2,
                "NAME": "Produce"
              },
              "NAME": "Item_6"
            },
            "ORDERTIME": 1528224280668,
            "MAPCOL": {
              "key3": 0.08025583241041634,
              "key2": 7.886688738692968,
              "key1": 7.997268326700826
            },
            "ORDERUNITS": 4,
            "ADDRESS": {
              "CITY": "CITY_3",
              "STATE": "STATE_6",
              "STREET": "STREET_5",
              "NUMBER": 29,
              "ZIPCODE": 46
            },
            "ARRAYCOL": [
              5.028181423106411,
              4.223556791057725,
              7.503771637501132,
              1.8346470572995977,
              8.628168574256188
            ]
          },
          "key": "100"
        },
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 3,
            "ITEMID": {
              "ITEMID": 6,
              "CATEGORY": {
                "ID": 2,
                "NAME": "Produce"
              },
              "NAME": "Item_6"
            },
            "ORDERTIME": 1528224281566,
            "MAPCOL": {
              "key3": 8.232202829012866,
              "key2": 4.76749034853443,
              "key1": 3.908548556676262
            },
            "ORDERUNITS": 6,
            "ADDRESS": {
              "CITY": "CITY_9",
              "STATE": "STATE_9",
              "STREET": "STREET_3",
              "NUMBER": 219,
              "ZIPCODE": 287
            },
            "ARRAYCOL": [
              9.404053021473551,
              2.005832055529364,
              0.16252060679229574,
              8.030440873506674,
              2.6822009490877683
            ]
          },
          "key": "101"
        },
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 4,
            "ITEMID": {
              "ITEMID": 2,
              "CATEGORY": {
                "ID": 1,
                "NAME": "Food"
              },
              "NAME": "Item_2"
            },
            "ORDERTIME": 1528224285603,
            "MAPCOL": {
              "key3": 8.58507015716884,
              "key2": 8.690191464522353,
              "key1": 3.966253991851106
            },
            "ORDERUNITS": 3,
            "ADDRESS": {
              "CITY": "CITY_3",
              "STATE": "STATE_5",
              "STREET": "STREET_8",
              "NUMBER": 380,
              "ZIPCODE": 866
            },
            "ARRAYCOL": [
              9.887072401304447,
              5.217021497196517,
              5.604857288119519,
              4.628527278923561,
              6.367135367927281
            ]
          },
          "key": "101"
        },
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 5,
            "ITEMID": {
              "ITEMID": 5,
              "CATEGORY": {
                "ID": 1,
                "NAME": "Produce"
              },
              "NAME": "Item_5"
            },
            "ORDERTIME": 1528224286568,
            "MAPCOL": {
              "key3": 4.9160189684727,
              "key2": 1.3876747586974092,
              "key1": 6.688854425726891
            },
            "ORDERUNITS": 5,
            "ADDRESS": {
              "CITY": "CITY_6",
              "STATE": "STATE_3",
              "STREET": "STREET_8",
              "NUMBER": 294,
              "ZIPCODE": 724
            },
            "ARRAYCOL": [
              1.6856668854084866,
              3.4970511301361484,
              9.143163282671962,
              2.196065628133206,
              4.343961390870502
            ]
          },
          "key": "101"
        }
      ],
      "outputs": [
        {
          "topic": "S3",
          "timestamp": 0,
          "value": {
            "ADDRESS__STREET": "STREET_3",
            "STATE": "STATE_9",
            "ITEMID__CATEGORY__ID": 2,
            "ZIPCODE": 287
          },
          "key": "101"
        }
      ]
    },
    {
      "inputs": [
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 1,
            "ITEMID": {
              "ITEMID": 6,
              "CATEGORY": {
                "ID": 2,
                "NAME": "Food"
              },
              "NAME": "Item_6"
            },
            "ORDERTIME": 1528224275715,
            "MAPCOL": {
              "key3": 3.8688222734507915,
              "key2": 5.878674158377773,
              "key1": 2.706938954083115
            },
            "ORDERUNITS": 2,
            "ADDRESS": {
              "CITY": "CITY_0",
              "STATE": "STATE_1",
              "STREET": "STREET_4",
              "NUMBER": 376,
              "ZIPCODE": 621
            },
            "ARRAYCOL": [
              6.27276558443913,
              8.720822816653817,
              4.904955205015469,
              0.28466518164817933,
              5.276269704236784
            ]
          },
          "key": "0"
        },
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 2,
            "ITEMID": {
              "ITEMID": 6,
              "CATEGORY": {
                "ID": 2,
                "NAME": "Produce"
              },
              "NAME": "Item_6"
            },
            "ORDERTIME": 1528224280668,
            "MAPCOL": {
              "key3": 0.08025583241041634,
              "key2": 7.886688738692968,
              "key1": 7.997268326700826
            },
            "ORDERUNITS": 4,
            "ADDRESS": {
              "CITY": "CITY_3",
              "STATE": "STATE_6",
              "STREET": "STREET_5",
              "NUMBER": 29,
              "ZIPCODE": 46
            },
            "ARRAYCOL": [
              5.028181423106411,
              4.223556791057725,
              7.503771637501132,
              1.8346470572995977,
              8.628168574256188
            ]
          },
          "key": "100"
        },
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 3,
            "ITEMID": {
              "ITEMID": 6,
              "CATEGORY": {
                "ID": 2,
                "NAME": "Produce"
              },
              "NAME": "Item_6"
            },
            "ORDERTIME": 1528224281566,
            "MAPCOL": {
              "key3": 8.232202829012866,
              "key2": 4.76749034853443,
              "key1": 3.908548556676262
            },
            "ORDERUNITS": 6,
            "ADDRESS": {
              "CITY": "CITY_9",
              "STATE": "STATE_9",
              "STREET": "STREET_3",
              "NUMBER": 219,
              "ZIPCODE": 287
            },
            "ARRAYCOL": [
              9.404053021473551,
              2.005832055529364,
              0.16252060679229574,
              8.030440873506674,
              2.6822009490877683
            ]
          },
          "key": "101"
        },
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 4,
            "ITEMID": {
              "ITEMID": 2,
              "CATEGORY": {
                "ID": 1,
                "NAME": "Food"
              },
              "NAME": "Item_2"
            },
            "ORDERTIME": 1528224285603,
            "MAPCOL": {
              "key3": 8.58507015716884,
              "key2": 8.690191464522353,
              "key1": 3.966253991851106
            },
            "ORDERUNITS": 3,
            "ADDRESS": {
              "CITY": "CITY_3",
              "STATE": "STATE_5",
              "STREET": "STREET_8",
              "NUMBER": 380,
              "ZIPCODE": 866
            },
            "ARRAYCOL": [
              9.887072401304447,
              5.217021497196517,
              5.604857288119519,
              4.628527278923561,
              6.367135367927281
            ]
          },
          "key": "101"
        },
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 5,
            "ITEMID": {
              "ITEMID": 5,
              "CATEGORY": {
                "ID": 1,
                "NAME": "Produce"
              },
              "NAME": "Item_5"
            },
            "ORDERTIME": 1528224286568,
            "MAPCOL": {
              "key3": 4.9160189684727,
              "key2": 1.3876747586974092,
              "key1": 6.688854425726891
            },
            "ORDERUNITS": 5,
            "ADDRESS": {
              "CITY": "CITY_6",
              "STATE": "STATE_3",
              "STREET": "STREET_8",
              "NUMBER": 294,
              "ZIPCODE": 724
            },
            "ARRAYCOL": [
              1.6856668854084866,
              3.4970511301361484,
              9.143163282671962,
              2.196065628133206,
              4.343961390870502
            ]
          },
          "key": "101"
        }
      ],
      "name": "simples struct select filter 3",
      "format": ["AVRO", "JSON"],
      "statements": [
        "CREATE STREAM orders (ordertime bigint, orderid bigint, itemid STRUCT< ITEMID BIGINT, NAME VARCHAR, CATEGORY STRUCT< ID BIGINT, NAME VARCHAR>>, ORDERUNITS double, ARRAYCOL array<double>, MAPCOL map<varchar, double>, address STRUCT < number bigint, street varchar, city varchar, state varchar, zipcode bigint>) WITH (kafka_topic='test_topic', key='orderid', value_format='{FORMAT}');",
        "CREATE STREAM S4 AS SELECT itemid->itemid, itemid as iid, itemid->category->name as catname FROM orders WHERE itemid->itemid = 6 OR itemid->category->name = 'Food';"
      ],
      "outputs": [
        {
          "topic": "S4",
          "timestamp": 0,
          "value": {
            "ITEMID__ITEMID": 6,
            "IID": {
              "ITEMID": 6,
              "CATEGORY": {
                "ID": 2,
                "NAME": "Food"
              },
              "NAME": "Item_6"
            },
            "CATNAME": "Food"
          },
          "key": "0"
        },
        {
          "topic": "S4",
          "timestamp": 0,
          "value": {
            "ITEMID__ITEMID": 6,
            "IID": {
              "ITEMID": 6,
              "CATEGORY": {
                "ID": 2,
                "NAME": "Produce"
              },
              "NAME": "Item_6"
            },
            "CATNAME": "Produce"
          },
          "key": "100"
        },
        {
          "topic": "S4",
          "timestamp": 0,
          "value": {
            "ITEMID__ITEMID": 6,
            "IID": {
              "ITEMID": 6,
              "CATEGORY": {
                "ID": 2,
                "NAME": "Produce"
              },
              "NAME": "Item_6"
            },
            "CATNAME": "Produce"
          },
          "key": "101"
        },
        {
          "topic": "S4",
          "timestamp": 0,
          "value": {
            "ITEMID__ITEMID": 2,
            "IID": {
              "ITEMID": 2,
              "CATEGORY": {
                "ID": 1,
                "NAME": "Food"
              },
              "NAME": "Item_2"
            },
            "CATNAME": "Food"
          },
          "key": "101"
        }
      ]
    },
    {
      "inputs": [
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 1,
            "ITEMID": {
              "ITEMID": 6,
              "CATEGORY": {
                "ID": 2,
                "NAME": "Food"
              },
              "NAME": "Item_6"
            },
            "ORDERTIME": 1528224275715,
            "MAPCOL": {
              "key3": 3.8688222734507915,
              "key2": 5.878674158377773,
              "key1": 2.706938954083115
            },
            "ORDERUNITS": 2,
            "ADDRESS": {
              "CITY": "CITY_0",
              "STATE": "STATE_1",
              "STREET": "STREET_4",
              "NUMBER": 376,
              "ZIPCODE": 621
            },
            "ARRAYCOL": [
              6.27276558443913,
              8.720822816653817,
              4.904955205015469,
              0.28466518164817933,
              5.276269704236784
            ]
          },
          "key": "0"
        },
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 2,
            "ITEMID": {
              "ITEMID": 6,
              "CATEGORY": {
                "ID": 2,
                "NAME": "Produce"
              },
              "NAME": "Item_6"
            },
            "ORDERTIME": 1528224280668,
            "MAPCOL": {
              "key3": 0.08025583241041634,
              "key2": 7.886688738692968,
              "key1": 7.997268326700826
            },
            "ORDERUNITS": 4,
            "ADDRESS": {
              "CITY": "CITY_3",
              "STATE": "STATE_6",
              "STREET": "STREET_5",
              "NUMBER": 29,
              "ZIPCODE": 46
            },
            "ARRAYCOL": [
              5.028181423106411,
              4.223556791057725,
              7.503771637501132,
              1.8346470572995977,
              8.628168574256188
            ]
          },
          "key": "100"
        },
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 3,
            "ITEMID": {
              "ITEMID": 6,
              "CATEGORY": {
                "ID": 2,
                "NAME": "Produce"
              },
              "NAME": "Item_6"
            },
            "ORDERTIME": 1528224281566,
            "MAPCOL": {
              "key3": 8.232202829012866,
              "key2": 4.76749034853443,
              "key1": 3.908548556676262
            },
            "ORDERUNITS": 6,
            "ADDRESS": {
              "CITY": "CITY_9",
              "STATE": "STATE_9",
              "STREET": "STREET_3",
              "NUMBER": 219,
              "ZIPCODE": 287
            },
            "ARRAYCOL": [
              9.404053021473551,
              2.005832055529364,
              0.16252060679229574,
              8.030440873506674,
              2.6822009490877683
            ]
          },
          "key": "101"
        },
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 4,
            "ITEMID": {
              "ITEMID": 2,
              "CATEGORY": {
                "ID": 1,
                "NAME": "Food"
              },
              "NAME": "Item_2"
            },
            "ORDERTIME": 1528224285603,
            "MAPCOL": {
              "key3": 8.58507015716884,
              "key2": 8.690191464522353,
              "key1": 3.966253991851106
            },
            "ORDERUNITS": 3,
            "ADDRESS": {
              "CITY": "CITY_3",
              "STATE": "STATE_5",
              "STREET": "STREET_8",
              "NUMBER": 380,
              "ZIPCODE": 866
            },
            "ARRAYCOL": [
              9.887072401304447,
              5.217021497196517,
              5.604857288119519,
              4.628527278923561,
              6.367135367927281
            ]
          },
          "key": "101"
        },
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 5,
            "ITEMID": {
              "ITEMID": 5,
              "CATEGORY": {
                "ID": 1,
                "NAME": "Produce"
              },
              "NAME": "Item_5"
            },
            "ORDERTIME": 1528224286568,
            "MAPCOL": {
              "key3": 4.9160189684727,
              "key2": 1.3876747586974092,
              "key1": 6.688854425726891
            },
            "ORDERUNITS": 5,
            "ADDRESS": {
              "CITY": "CITY_6",
              "STATE": "STATE_3",
              "STREET": "STREET_8",
              "NUMBER": 294,
              "ZIPCODE": 724
            },
            "ARRAYCOL": [
              1.6856668854084866,
              3.4970511301361484,
              9.143163282671962,
              2.196065628133206,
              4.343961390870502
            ]
          },
          "key": "101"
        }
      ],
      "name": "simple struct select filter 4",
      "format": ["AVRO", "JSON"],
      "statements": [
        "CREATE STREAM orders (ordertime bigint, orderid bigint, itemid STRUCT< ITEMID BIGINT, NAME VARCHAR, CATEGORY STRUCT< ID BIGINT, NAME VARCHAR>>, ORDERUNITS double, ARRAYCOL array<double>, MAPCOL map<varchar, double>, address STRUCT < number bigint, street varchar, city varchar, state varchar, zipcode bigint>) WITH (kafka_topic='test_topic', key='orderid', value_format='{FORMAT}');",
        "CREATE STREAM S5 as SELECT itemid->itemid * 10 as itemid, concat(itemid->category->name, '_HELLO') as cname, len(address->state) as state_length FROM orders WHERE address->state LIKE '%1' OR address->state LIKE '%9';"
      ],
      "outputs": [
        {
          "topic": "S5",
          "timestamp": 0,
          "value": {
            "ITEMID": 60,
            "STATE_LENGTH": 7,
            "CNAME": "Food_HELLO"
          },
          "key": "0"
        },
        {
          "topic": "S5",
          "timestamp": 0,
          "value": {
            "ITEMID": 60,
            "STATE_LENGTH": 7,
            "CNAME": "Produce_HELLO"
          },
          "key": "101"
        }
      ]
    },
    {
      "inputs": [
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 1,
            "ITEMID": {
              "CATEGORY": {
                "ID": 2,
                "NAME": "Food"
              },
              "NAME": "Item_6"
            },
            "ORDERTIME": 1528224275715,
            "MAPCOL": {
              "key3": 3.8688222734507915,
              "key2": 5.878674158377773,
              "key1": 2.706938954083115
            },
            "ORDERUNITS": 2,
            "ADDRESS": {
              "CITY": "CITY_0",
              "STATE": "STATE_1",
              "STREET": "STREET_4",
              "NUMBER": 376,
              "ZIPCODE": 621
            },
            "ARRAYCOL": [
              6.27276558443913,
              8.720822816653817,
              4.904955205015469,
              0.28466518164817933,
              5.276269704236784
            ]
          },
          "key": "0"
        },
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 2,
            "ITEMID": {
              "ITEMID": 6,
              "NAME": "Item_6"
            },
            "ORDERTIME": 1528224280668,
            "MAPCOL": {
              "key3": 0.08025583241041634,
              "key2": 7.886688738692968,
              "key1": 7.997268326700826
            },
            "ORDERUNITS": 4,
            "ADDRESS": {
              "CITY": "CITY_3",
              "STATE": "STATE_6",
              "STREET": "STREET_5",
              "NUMBER": 29,
              "ZIPCODE": 46
            },
            "ARRAYCOL": [
              5.028181423106411,
              4.223556791057725,
              7.503771637501132,
              1.8346470572995977,
              8.628168574256188
            ]
          },
          "key": "100"
        },
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 3,
            "ITEMID": {
              "ITEMID": 6,
              "CATEGORY": {
                "NAME": "Produce"
              },
              "NAME": "Item_6"
            },
            "ORDERTIME": 1528224281566,
            "MAPCOL": {
              "key3": 8.232202829012866,
              "key2": 4.76749034853443,
              "key1": 3.908548556676262
            },
            "ORDERUNITS": 6,
            "ADDRESS": {
              "CITY": "CITY_9",
              "STATE": "STATE_9",
              "STREET": "STREET_3",
              "NUMBER": 219,
              "ZIPCODE": 287
            },
            "ARRAYCOL": [
              9.404053021473551,
              2.005832055529364,
              0.16252060679229574,
              8.030440873506674,
              2.6822009490877683
            ]
          },
          "key": "101"
        },
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 4,
            "ORDERTIME": 1528224285603,
            "MAPCOL": {
              "key3": 8.58507015716884,
              "key2": 8.690191464522353,
              "key1": 3.966253991851106
            },
            "ORDERUNITS": 3,
            "ADDRESS": {
              "CITY": "CITY_3",
              "STATE": "STATE_5",
              "STREET": "STREET_8",
              "NUMBER": 380,
              "ZIPCODE": 866
            },
            "ARRAYCOL": [
              9.887072401304447,
              5.217021497196517,
              5.604857288119519,
              4.628527278923561,
              6.367135367927281
            ]
          },
          "key": "101"
        },
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "ORDERID": 5,
            "ITEMID": {
              "ITEMID": 5,
              "CATEGORY": {
                "ID": 1,
                "NAME": "Produce"
              },
              "NAME": "Item_5"
            },
            "ORDERTIME": 1528224286568,
            "MAPCOL": {
              "key3": 4.9160189684727,
              "key2": 1.3876747586974092,
              "key1": 6.688854425726891
            },
            "ORDERUNITS": 5,
            "ADDRESS": {
              "CITY": "CITY_6",
              "STATE": "STATE_3",
              "STREET": "STREET_8",
              "NUMBER": 294,
              "ZIPCODE": 724
            },
            "ARRAYCOL": [
              1.6856668854084866,
              3.4970511301361484,
              9.143163282671962,
              2.196065628133206,
              4.343961390870502
            ]
          },
          "key": "101"
        }
      ],
      "name": "simple struct select with nulls",
      "format": ["AVRO", "JSON"],
      "statements": [
        "CREATE STREAM orders (ordertime bigint, orderid bigint, itemid STRUCT< ITEMID BIGINT, NAME VARCHAR, CATEGORY STRUCT< ID BIGINT, NAME VARCHAR>>, ORDERUNITS double, ARRAYCOL array<double>, MAPCOL map<varchar, double>, address STRUCT < number bigint, street varchar, city varchar, state varchar, zipcode bigint>) WITH (kafka_topic='test_topic', key='orderid', value_format='{FORMAT}');",
        "CREATE STREAM S6 as SELECT itemid->itemid * 10 as itemid, itemid->category->id as catid, itemid->category as cat FROM orders;"
      ],
      "outputs": [
        {
          "topic": "S6",
          "timestamp": 0,
          "value": {
            "ITEMID": null,
            "CATID": 2,
            "CAT": {
              "ID": 2,
              "NAME": "Food"
            }
          },
          "key": "0"
        },
        {
          "topic": "S6",
          "timestamp": 0,
          "value": {
            "ITEMID": 60,
            "CATID": null,
            "CAT": null
          },
          "key": "100"
        },
        {
          "topic": "S6",
          "timestamp": 0,
          "value": {
            "ITEMID": 60,
            "CATID": null,
            "CAT": {
              "ID": null,
              "NAME": "Produce"
            }
          },
          "key": "101"
        },
        {
          "topic": "S6",
          "timestamp": 0,
          "value": {
            "ITEMID": null,
            "CATID": null,
            "CAT": null
          },
          "key": "101"
        },
        {
          "topic": "S6",
          "timestamp": 0,
          "value": {
            "ITEMID": 50,
            "CATID": 1,
            "CAT": {
              "ID": 1,
              "NAME": "Produce"
            }
          },
          "key": "101"
        }
      ]
    },
    {
      "inputs": [
        {
          "topic": "test_topic",
          "timestamp": 0,
          "value": {
            "s": {
              "s": "Item_6"
            }
          },
          "key": "0"
        }
      ],
      "statements": [
        "CREATE STREAM s (s STRUCT<s VARCHAR>) WITH (kafka_topic='test_topic', value_format='json');",
        "CREATE STREAM S7 as SELECT s as s1, s.s as s2, s->s as s3, s.s->s as s4 FROM s;"
      ],
      "name": "simple struct select for ambiguity",
      "outputs": [
        {
          "topic": "S7",
          "timestamp": 0,
          "value": {
            "S3": "Item_6",
            "S2": {
              "S": "Item_6"
            },
            "S1": {
              "S": "Item_6"
            },
            "S4": "Item_6"
          },
          "key": "0"
        }
      ]
    },
    {
      "name": "direct use of FETCH_FIELD_FROM_STRUCT",
      "statements": [
        "CREATE STREAM input (s STRUCT<f0 BIGINT>) WITH (kafka_topic='input_topic', value_format='JSON');",
        "CREATE STREAM output AS SELECT FETCH_FIELD_FROM_STRUCT(s, 'f0') FROM input;"
      ],
      "expectedException": {
        "type": "io.confluent.ksql.util.KsqlStatementException",
        "message": "Can't find any functions with the name 'FETCH_FIELD_FROM_STRUCT'"
      }
    }
  ]
}