{
  "comments": [
    "Tests covering the use of the ALTER function."
  ],
  "tests": [
    {
      "name": "add a column to a stream",
      "statements": [
        "CREATE STREAM TEST (K STRING KEY, NAME VARCHAR) WITH (kafka_topic='test_topic', value_format='JSON');",
        "ALTER STREAM TEST ADD COLUMN A STRING;",
        "CREATE STREAM OUTPUT AS SELECT * FROM TEST;"
      ],
      "inputs": [
        {"topic": "test_topic", "value": {"NAME": "anaconda"}}
      ],
      "outputs": [
        {"topic": "OUTPUT", "value": {"NAME": "anaconda", "A": null}}
      ]
    },
    {
      "name": "add a column to a table",
      "statements": [
        "CREATE TABLE TEST (ID INT PRIMARY KEY, NAME VARCHAR) WITH (kafka_topic='test_topic', value_format='JSON');",
        "ALTER TABLE TEST ADD A STRING;",
        "CREATE TABLE OUTPUT AS SELECT ID, A FROM TEST;"
      ],
      "inputs": [
        {"topic": "test_topic", "value": {"K": 4, "NAME": "anaconda"}}
      ],
      "outputs": [
        {"topic": "test_topic", "value": {"NAME": "anaconda", "A": null}}
      ]
    },
    {
      "name": "adding a column to a CSAS statement should fail.",
      "statements": [
        "CREATE STREAM A (K STRING KEY, NAME VARCHAR) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE STREAM B AS SELECT * FROM A;",
        "ALTER STREAM B ADD COLUMN FOO STRING;"
      ],
      "expectedException" : {
        "type": "io.confluent.ksql.util.KsqlException",
        "message": "ALTER command is not supported for CREATE ... AS statements."
      }
    }
  ]
}