{
  "comments": [
    "Tests covering the use of advanced lambda functions."
  ],
  "tests": [
    {
      "name": "apply transform lambda function to array",
      "statements": [
        "CREATE STREAM TEST (ID BIGINT KEY, VALUE MAP<STRING, ARRAY<INT>>) WITH (kafka_topic='test_topic', value_format='AVRO');",
        "CREATE STREAM OUTPUT as SELECT ID, TRANSFORM(TRANSFORM(VALUE, (x,y) => x, (x,y) => FIlTER(y, z => z IS NOT NULL)), (x,y) => UCASE(x) , (k,v) => ARRAY_MAX(v)) as FILTERED_TRANSFORMED from TEST emit changes;"
      ],
      "inputs": [
        {"topic": "test_topic", "key": 0,"value": {"value":  {"a": [2,null,5], "b": [-1,-2]}}},
        {"topic": "test_topic", "key": 1,"value": {"value":  {"c": [null,null,5], "t": [3, 1]}}},
        {"topic": "test_topic", "key": 2,"value": {"value":  {"d": [4], "q": [0, 0]}}}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"FILTERED_TRANSFORMED":{"A": 5, "B": -1}}},
        {"topic": "OUTPUT", "key": 1, "value": {"FILTERED_TRANSFORMED":{"C": 5, "T":  3}}},
        {"topic": "OUTPUT", "key": 2, "value": {"FILTERED_TRANSFORMED":{"D": 4, "Q": 0}}}
      ]
    }
  ]
} 