{
  "comments": [
    "Tests around HAVING clauses"
  ],
  "tests": [
    {
      "name": "table having",
      "statements": [
        "CREATE STREAM TEST (ID BIGINT KEY, NAME varchar, VALUE bigint) WITH (kafka_topic='test_topic', value_format='DELIMITED');",
        "CREATE TABLE T1 as select id, sum(value) as sum from test WINDOW TUMBLING (SIZE 30 SECONDS) group by id HAVING sum(value) > 100;"
      ],
      "inputs": [
        {"topic": "test_topic", "key": 0,"value": "zero,0"},
        {"topic": "test_topic", "key": 1,"value": "one,101"},
        {"topic": "test_topic", "key": 1,"value": "one,-5"}
      ],
      "outputs": [
        {"topic": "T1", "key": 1,"value": "101", "window": {"start": 0, "end": 30000, "type": "time"}},
        {"topic": "T1", "key": 1,"value": null, "window": {"start": 0, "end": 30000, "type": "time"}}
      ]
    },
    {
      "name": "calculate average in having",
      "statements": [
        "CREATE STREAM TEST (ID BIGINT KEY, NAME varchar, VALUE bigint) WITH (kafka_topic='test_topic', value_format='DELIMITED');",
        "CREATE TABLE AVG AS select id, sum(value)/count(id) as avg from test GROUP BY id HAVING sum(value)/count(id)> 25;"
      ],
      "inputs": [
        {"topic": "test_topic", "key": 0,"value": "zero,50"},
        {"topic": "test_topic", "key": 0,"value": "zero,10"},
        {"topic": "test_topic", "key": 0,"value": "zero,15"},
        {"topic": "test_topic", "key": 1,"value": "one,100"},
        {"topic": "test_topic", "key": 1,"value": "one,10"}
      ],
      "outputs": [
        {"topic": "AVG", "key": 0,"value": "50"},
        {"topic": "AVG", "key": 0,"value": "30"},
        {"topic": "AVG", "key": 0,"value": null},
        {"topic": "AVG", "key": 1,"value": "100"},
        {"topic": "AVG", "key": 1,"value": "55"}
      ]
    }
  ]
}