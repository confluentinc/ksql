{
  "comments": ["tests to ensure that interval is not usable in places it should not be used"],
  "tests": [
    {
      "name": "cannot be a literal outside of a function",
      "statements": [
        "CREATE STREAM TEST (ID STRING KEY, NAME STRING) WITH (kafka_topic='test', value_format='DELIMITED');",
        "CREATE STREAM TEST2 AS SELECT id, 10 MILLISECONDS FROM TEST;"
      ],
      "expectedException": {
        "type": "io.confluent.ksql.util.KsqlStatementException",
        "message": "\"MILLISECONDS\" is a reserved keyword and it can't be used as an identifier."
      }
    },
    {
      "name": "cannot be a column type",
      "statements": [
        "CREATE STREAM TEST (ID STRING KEY, time INTERVAL) WITH (kafka_topic='test', value_format='DELIMITED');"
      ],
      "expectedException": {
        "type": "io.confluent.ksql.util.KsqlStatementException",
        "message": "Cannot resolve unknown type: INTERVAL"
      }
    },
    {
      "name": "cannot be used as an integer argument",
      "statements": [
        "CREATE STREAM TEST (ID STRING KEY, NAME STRING) WITH (kafka_topic='test', value_format='DELIMITED');",
        "CREATE STREAM TEST2 AS SELECT ID, SUBSTRING(NAME, 1 DAY) FROM TEST;"
      ],
      "expectedException": {
        "type": "io.confluent.ksql.util.KsqlStatementException",
        "message": "Function 'substring' does not accept parameters (STRING, INTERVAL)."
      }
    },
    {
      "name": "interval expression can be defined with an expression",
      "statements": [
        "CREATE STREAM TEST (ID STRING KEY, TIME TIMESTAMP, A INT) WITH (kafka_topic='test', value_format='DELIMITED');",
        "CREATE STREAM TEST2 AS SELECT ID, TIMESTAMPADD(TIME, ABS(A+5) MILLISECONDS) FROM TEST;"
      ],
      "inputs": [
        {"topic": "test", "value": "10,10"}
      ],
      "outputs": [
        {"topic": "TEST2", "value": "25"}
      ]
    },
    {
      "name": "interval expression cannot be defined by a string.",
      "statements": [
        "CREATE STREAM TEST (ID STRING KEY, TIME TIMESTAMP) WITH (kafka_topic='test', value_format='DELIMITED');",
        "CREATE STREAM TEST2 AS SELECT ID, TIMESTAMPADD(TIME, 'baaa' MILLISECONDS) FROM TEST;"
      ],
      "expectedException": {
        "type": "io.confluent.ksql.util.KsqlStatementException",
        "message": "Intervals must be defined using an INTEGER or BIGINT typed expression; found STRING instead."
      }
    },
    {
      "name": "numbers cannot be passed as intervals.",
      "statements": [
        "CREATE STREAM TEST (ID STRING KEY, TIME TIMESTAMP) WITH (kafka_topic='test', value_format='DELIMITED');",
        "CREATE STREAM TEST2 AS SELECT ID, TIMESTAMPADD(TIME, 432432) FROM TEST;"
      ],
      "expectedException": {
        "type": "io.confluent.ksql.util.KsqlStatementException",
        "message": "Function 'timestampadd' does not accept parameters (TIMESTAMP, INTEGER)."
      }
    }
  ]
}