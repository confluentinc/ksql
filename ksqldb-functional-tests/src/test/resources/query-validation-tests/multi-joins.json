{
  "comments": [
    "NOTE: these tests only attempt to cover multi-join scenarios; ensuring the validity of the ",
    "sub-join topologies is delegated to joins.json"
  ],
  "tests": [
    {
      "name": "first join column in projection",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT S1.ID, s1.V0, t2.V0, t3.V0 FROM S1 JOIN T2 ON S1.ID = T2.ID JOIN T3 ON S1.ID = T3.ID;"
      ],
      "inputs": [
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 10},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 11},
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 12}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "T2_V0": 2, "T3_V0": 3}, "timestamp": 12}
      ],
      "post": {
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "S1_ID INT KEY, S1_V0 BIGINT, T2_V0 BIGINT, T3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "second join column in projection",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT T2.ID, s1.V0, t2.V0, t3.V0 FROM S1 JOIN T2 ON S1.ID = T2.ID JOIN T3 ON S1.ID = T3.ID;"
      ],
      "inputs": [
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 10},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 11},
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 12}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "T2_V0": 2, "T3_V0": 3}, "timestamp": 12}
      ],
      "post": {
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "T2_ID INT KEY, S1_V0 BIGINT, T2_V0 BIGINT, T3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "third join column in projection",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT T3.ID, s1.V0, t2.V0, t3.V0 FROM S1 JOIN T2 ON S1.ID = T2.ID JOIN T3 ON S1.ID = T3.ID;"
      ],
      "inputs": [
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 10},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 11},
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 12}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "T2_V0": 2, "T3_V0": 3}, "timestamp": 12}
      ],
      "post": {
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "T3_ID INT KEY, S1_V0 BIGINT, T2_V0 BIGINT, T3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "only viable in projection",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE STREAM S2 (ID INT KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE STREAM S3 (ID INT KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT S1.ID, s1.V0, s2.V0, s3.V0 FROM S1 JOIN S2 WITHIN 10 seconds ON S1.ID = abs(S2.ID) JOIN S3 WITHIN 10 seconds ON abs(S2.ID) = abs(S3.ID);"
      ],
      "inputs": [
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 10},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 11},
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 12}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": 2, "S3_V0": 3}, "timestamp": 12}
      ],
      "post": {
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "S1_ID INT KEY, S1_V0 BIGINT, S2_V0 BIGINT, S3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "inner-inner - missing join columns in projection",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT s1.V0, t2.V0, t3.V0 FROM S1 INNER JOIN T2 ON S1.ID = T2.ID INNER JOIN T3 ON S1.ID = T3.ID;"
      ],
      "expectedException": {
        "type": "io.confluent.ksql.util.KsqlStatementException",
        "message": "The query used to build `OUTPUT` must include the join expressions S1.ID, T2.ID or T3.ID in its projection (eg, SELECT S1.ID...)."
      }
    },
    {
      "name": "inner-inner with expression in first - missing join columns in projection",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT s1.V0, t2.V0, t3.V0 FROM S1 INNER JOIN T2 ON S1.ID + 1 = T2.ID INNER JOIN T3 ON S1.ID = T3.ID;"
      ],
      "expectedException": {
        "type": "io.confluent.ksql.util.KsqlStatementException",
        "message": "The query used to build `OUTPUT` must include the join expressions S1.ID or T3.ID in its projection (eg, SELECT S1.ID...)."
      }
    },
    {
      "name": "inner-inner with expression in second - missing join columns in projection",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT s1.V0, t2.V0, t3.V0 FROM S1 INNER JOIN T2 ON S1.ID = T2.ID INNER JOIN T3 ON S1.ID + 1 = T3.ID;"
      ],
      "expectedException": {
        "type": "io.confluent.ksql.util.KsqlStatementException",
        "message": "The query used to build `OUTPUT` must include the join expression T3.ID in its projection (eg, SELECT T3.ID...)."
      }
    },
    {
      "name": "left-left - missing join columns in projection",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT s1.V0, t2.V0, t3.V0 FROM S1 LEFT JOIN T2 ON S1.ID = T2.ID LEFT JOIN T3 ON S1.ID = T3.ID;"
      ],
      "expectedException": {
        "type": "io.confluent.ksql.util.KsqlStatementException",
        "message": "The query used to build `OUTPUT` must include the join expressions S1.ID, T2.ID or T3.ID in its projection (eg, SELECT S1.ID...)."
      }
    },
    {
      "name": "left-left with expression in first - missing join columns in projection",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT s1.V0, t2.V0, t3.V0 FROM S1 LEFT JOIN T2 ON S1.ID + 1 = T2.ID LEFT JOIN T3 ON S1.ID = T3.ID;"
      ],
      "expectedException": {
        "type": "io.confluent.ksql.util.KsqlStatementException",
        "message": "The query used to build `OUTPUT` must include the join expressions S1.ID or T3.ID in its projection (eg, SELECT S1.ID...)."
      }
    },
    {
      "name": "left-left with expression in second - missing join columns in projection",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT s1.V0, t2.V0, t3.V0 FROM S1 LEFT JOIN T2 ON S1.ID = T2.ID LEFT JOIN T3 ON S1.ID + 1 = T3.ID;"
      ],
      "expectedException": {
        "type": "io.confluent.ksql.util.KsqlStatementException",
        "message": "The query used to build `OUTPUT` must include the join expression T3.ID in its projection (eg, SELECT T3.ID...)."
      }
    },
    {
      "name": "stream-table-table - table key format mismatch",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', key_format='JSON', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', key_format='KAFKA', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', key_format='DELIMITED', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT S1.ID, s1.V0, t2.V0, t3.V0 FROM S1 JOIN T2 ON S1.ID = T2.ID JOIN T3 ON S1.ID = T3.ID;"
      ],
      "inputs": [
        {"topic": "right2", "key": "0", "value": {"V0": 3}, "timestamp": 10},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 11},
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 12},
        {"topic": "left", "key": 1, "value": {"V0": 1}, "timestamp": 14}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "T2_V0": 2, "T3_V0": 3}, "timestamp": 12}
      ]
    },
    {
      "name": "stream-table-table - inner-inner",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT S1.ID, s1.V0, t2.V0, t3.V0 FROM S1 JOIN T2 ON S1.ID = T2.ID JOIN T3 ON S1.ID = T3.ID;"
      ],
      "inputs": [
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 10},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 11},
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 12},
        {"topic": "left", "key": 1, "value": {"V0": 1}, "timestamp": 14}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "T2_V0": 2, "T3_V0": 3}, "timestamp": 12}
      ],
      "post": {
        "topics": {"blacklist": ".*-repartition"},
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "S1_ID INT KEY, S1_V0 BIGINT, T2_V0 BIGINT, T3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "stream-table-table - left-left",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT S1.ID, s1.V0, t2.V0, t3.V0 FROM S1 LEFT JOIN T2 ON S1.ID = T2.ID LEFT JOIN T3 ON S1.ID = T3.ID;"
      ],
      "inputs": [
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 9},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 10},
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 11},
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 12},
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 13}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "T2_V0": null, "T3_V0": null}, "timestamp": 9},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "T2_V0": 2, "T3_V0": null}, "timestamp": 11},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "T2_V0": 2, "T3_V0": 3}, "timestamp": 13}
      ],
      "post": {
        "topics": {"blacklist": ".*-repartition"},
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "S1_ID INT KEY, S1_V0 BIGINT, T2_V0 BIGINT, T3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "stream-table-table - left-inner",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT S1.ID, s1.V0, t2.V0, t3.V0 FROM S1 LEFT JOIN T2 ON S1.ID = T2.ID JOIN T3 ON S1.ID = T3.ID;"
      ],
      "inputs": [
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 9},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 10},
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 11},
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 12},
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 13}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "T2_V0": 2, "T3_V0": 3}, "timestamp": 13}
      ],
      "post": {
        "topics": {"blacklist": ".*-repartition"},
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "S1_ID INT KEY, S1_V0 BIGINT, T2_V0 BIGINT, T3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "stream-table-table - inner-left",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT S1.ID, s1.V0, t2.V0, t3.V0 FROM S1 JOIN T2 ON S1.ID = T2.ID LEFT JOIN T3 ON S1.ID = T3.ID;"
      ],
      "inputs": [
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 9},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 10},
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 11},
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 12},
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 13}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "T2_V0": 2, "T3_V0": null}, "timestamp": 11},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "T2_V0": 2, "T3_V0": 3}, "timestamp": 13}
      ],
      "post": {
        "topics": {"blacklist": ".*-repartition"},
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "S1_ID INT KEY, S1_V0 BIGINT, T2_V0 BIGINT, T3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "stream-table-table - inner-inner - rekey",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, K INT, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT S1.K, s1.V0, t2.V0, t3.V0 FROM S1 JOIN T2 ON S1.K = T2.ID JOIN T3 ON S1.K = T3.ID;"
      ],
      "inputs": [
        {"topic": "right2", "key": 1, "value": {"V0": 3}, "timestamp": 10},
        {"topic": "right", "key": 1, "value": {"V0": 2}, "timestamp": 11},
        {"topic": "left", "key": 0, "value": {"k": 1, "V0": 1}, "timestamp": 12}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 1, "value": {"S1_V0": 1, "T2_V0": 2, "T3_V0": 3}, "timestamp": 12}
      ],
      "post": {
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "K INT KEY, S1_V0 BIGINT, T2_V0 BIGINT, T3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "stream-table-table - inner-inner - rekey with different expression",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, K INT, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT T3.ID, s1.V0, t2.V0, t3.V0 FROM S1 JOIN T2 ON S1.K - 1 = T2.ID JOIN T3 ON S1.K + 1 = T3.ID;"
      ],
      "inputs": [
        {"topic": "right2", "key": 3, "value": {"V0": 3}, "timestamp": 10},
        {"topic": "right", "key": 1, "value": {"V0": 2}, "timestamp": 11},
        {"topic": "left", "key": 0, "value": {"k": 2, "V0": 1}, "timestamp": 12}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 3, "value": {"S1_V0": 1, "T2_V0": 2, "T3_V0": 3}, "timestamp": 12}
      ],
      "post": {
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "T3_ID INT KEY, S1_V0 BIGINT, T2_V0 BIGINT, T3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "stream-table-table - inner-inner - rekey on different expression",
      "comments": ["https://github.com/confluentinc/ksql/issues/5062"],
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, K INT, V0 int) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 int) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 int) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT S1.K, s1.V0, t2.V0, t3.V0 FROM S1 JOIN T2 ON S1.V0 = T2.ID JOIN T3 ON S1.K = T3.ID;"
      ],
      "inputs": [
        {"topic": "right2", "key": 2, "value": {"V0": 3}, "timestamp": 10},
        {"topic": "right", "key": 1, "value": {"V0": 2}, "timestamp": 11},
        {"topic": "left", "key": 0, "value": {"k": 2, "V0": 1}, "timestamp": 12}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 2, "value": {"S1_V0": 1, "T2_V0": 2, "T3_V0": 3}, "timestamp": 12}
      ],
      "post": {
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "K INT KEY, S1_V0 INT, T2_V0 INT, T3_V0 INT"}
        ]
      }
    },
    {
      "name": "stream-table-table - explicit ROWTIME",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT *, S1.ROWTIME, T2.ROWTIME, T3.ROWTIME FROM S1 JOIN T2 ON S1.ID = T2.ID JOIN T3 ON S1.ID = T3.ID;"
      ],
      "inputs": [
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 10},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 11},
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 12}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "T2_ID": 0, "T2_V0": 2, "T3_ID": 0, "T3_V0": 3, "S1_ROWTIME": 12, "T2_ROWTIME": 11, "T3_ROWTIME": 10}, "timestamp": 12}
      ],
      "post": {
        "topics": {"blacklist": ".*-repartition"},
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "S1_ID INT KEY, S1_V0 BIGINT, T2_ID INT, T2_V0 BIGINT, T3_ID INT, T3_V0 BIGINT, S1_ROWTIME BIGINT, T2_ROWTIME BIGINT, T3_ROWTIME BIGINT"}
        ]
      }
    },
    {
      "name": "stream-table-table - inner-inner - select * ",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT * FROM S1 JOIN T2 ON S1.ID = T2.ID JOIN T3 ON S1.ID = T3.ID;"
      ],
      "inputs": [
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 10},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 11},
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 12}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "T2_ID": 0, "T2_V0": 2, "T3_ID": 0, "T3_V0": 3}, "timestamp": 12}
      ],
      "post": {
        "topics": {"blacklist": ".*-repartition"},
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "S1_ID INT KEY, S1_V0 BIGINT, T2_ID INT, T2_V0 BIGINT, T3_ID INT, T3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "stream-table-table - inner-inner - select left.* only",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT s1.* FROM S1 JOIN T2 ON S1.ID = T2.ID JOIN T3 ON S1.ID = T3.ID;"
      ],
      "inputs": [
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 10},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 11},
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 12}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1}, "timestamp": 12}
      ],
      "post": {
        "topics": {"blacklist": ".*-repartition"},
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "S1_ID INT KEY, S1_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "stream-table-table - inner-inner - select left.* and specific fields from rights",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT s1.*, t2.V0, t3.V0 FROM S1 JOIN T2 ON S1.ID = T2.ID JOIN T3 ON S1.ID = T3.ID;"
      ],
      "inputs": [
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 10},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 11},
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 12}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "T2_V0": 2, "T3_V0": 3}, "timestamp": 12}
      ],
      "post": {
        "topics": {"blacklist": ".*-repartition"},
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "S1_ID INT KEY, S1_V0 BIGINT, T2_V0 BIGINT, T3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "stream-table-table - inner-inner - select sources.*",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT s1.*, t2.*, t3.* FROM S1 JOIN T2 ON S1.ID = T2.ID JOIN T3 ON S1.ID = T3.ID;"
      ],
      "inputs": [
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 10},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 11},
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 12}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "T2_ID": 0, "T2_V0": 2, "T3_ID": 0, "T3_V0": 3}, "timestamp": 12}
      ],
      "post": {
        "topics": {"blacklist": ".*-repartition"},
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "S1_ID INT KEY, S1_V0 BIGINT, T2_ID INT, T2_V0 BIGINT, T3_ID INT, T3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "stream-table-table - inner-inner - flip join expression",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT T2.ID, s1.V0, t2.V0, t3.V0 FROM S1 JOIN T2 ON T2.ID = S1.ID JOIN T3 ON T3.ID = S1.ID;"
      ],
      "inputs": [
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 10},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 11},
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 12},
        {"topic": "left", "key": 1, "value": {"V0": 1}, "timestamp": 14}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "T2_V0": 2, "T3_V0": 3}, "timestamp": 12}
      ],
      "post": {
        "topics": {"blacklist": ".*-repartition"},
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "T2_ID INT KEY, S1_V0 BIGINT, T2_V0 BIGINT, T3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "stream-table-table - inner-inner - rekey and flip join expression",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, K INT, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT T3.ID, s1.V0, t2.V0, t3.V0 FROM S1 JOIN T2 ON T2.ID = S1.K JOIN T3 ON T3.ID = S1.K;"
      ],
      "inputs": [
        {"topic": "right2", "key": 1, "value": {"V0": 3}, "timestamp": 10},
        {"topic": "right", "key": 1, "value": {"V0": 2}, "timestamp": 11},
        {"topic": "left", "key": 0, "value": {"k": 1, "V0": 1}, "timestamp": 12}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 1, "value": {"S1_V0": 1, "T2_V0": 2, "T3_V0": 3}, "timestamp": 12}
      ],
      "post": {
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "T3_ID INT KEY, S1_V0 BIGINT, T2_V0 BIGINT, T3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "stream-table-table - inner-inner - aliasing",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT S.ID, s.V0, t.V0, tt.V0 FROM S1 AS s JOIN T2 AS t ON S.ID = T.ID JOIN T3 AS tt ON S.ID = TT.ID;"
      ],
      "inputs": [
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 10},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 11},
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 12},
        {"topic": "left", "key": 1, "value": {"V0": 1}, "timestamp": 14}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S_V0": 1, "T_V0": 2, "TT_V0": 3}, "timestamp": 12}
      ],
      "post": {
        "topics": {"blacklist": ".*-repartition"},
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "S_ID INT KEY, S_V0 BIGINT, T_V0 BIGINT, TT_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "table-table-table - inner-inner - aliasing",
      "statements": [
        "CREATE TABLE left_table (l_id BIGINT PRIMARY KEY, f1 BIGINT) WITH (kafka_topic='left_topic', format='JSON');",
        "CREATE TABLE middle_table (m_id BIGINT PRIMARY KEY, f2 BIGINT, other STRING) WITH (kafka_topic='middle_topic', format='JSON');",
        "CREATE TABLE right_table (r_id BIGINT PRIMARY KEY, f3 BIGINT) WITH (kafka_topic='right_topic', format='JSON');",
        "CREATE TABLE output AS SELECT l_id, as_value(m_id) as m_id, f1, mt.f2, f3 FROM left_table AS lt JOIN middle_table AS mt ON lt.l_id = mt.m_id JOIN right_table AS rt ON lt.l_id = r_id;"
      ],
      "inputs": [
        {"topic": "left_topic", "key": 0, "value": {"f1": 1}, "timestamp": 0},
        {"topic": "middle_topic", "key": 0, "value": {"f2": 2}, "timestamp": 1},
        {"topic": "right_topic", "key": 0, "value": {"f3": 3}, "timestamp": 2}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"M_ID": 0, "F1": 1, "F2": 2, "F3": 3}, "timestamp": 2}
      ],
      "post": {
        "topics": {"blacklist": ".*-repartition"},
        "sources": [
          {"name": "OUTPUT", "type": "table", "schema": "L_ID BIGINT PRIMARY KEY, M_ID BIGINT, F1 BIGINT, F2 BIGINT, F3 BIGINT"}
        ]
      }
    },
    {
      "name": "stream-stream-table - inner-inner",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE STREAM S2 (ID INT KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT S2.ID, s1.V0, s2.V0, t3.V0 FROM S1 JOIN S2 WITHIN 10 seconds ON S1.ID = S2.ID JOIN T3 ON S1.ID = T3.ID;"
      ],
      "inputs": [
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 10},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 11},
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 12},
        {"topic": "right", "key": 0, "value": {"V0": 4}, "timestamp": 13},
        {"topic": "left", "key": 0, "value": {"V0": 5}, "timestamp": 100000},
        {"topic": "right", "key": 0, "value": {"V0": 6}, "timestamp": 100001}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": 2, "T3_V0": 3}, "timestamp": 12},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": 4, "T3_V0": 3}, "timestamp": 13},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 5, "S2_V0": 6, "T3_V0": 3}, "timestamp": 100001}
      ],
      "post": {
        "topics": {"blacklist": ".*-repartition"},
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "S2_ID INT KEY, S1_V0 BIGINT, S2_V0 BIGINT, T3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "stream-stream-table - inner-inner - rekey left",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, k int, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE STREAM S2 (ID INT KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT S1.K, s1.V0, s2.V0, t3.V0 FROM S1 JOIN S2 WITHIN 10 seconds ON S1.K = S2.ID JOIN T3 ON S1.K = T3.ID;"
      ],
      "inputs": [
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 10},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 11},
        {"topic": "left", "key": 1, "value": {"k": 0, "V0": 1}, "timestamp": 12},
        {"topic": "right", "key": 0, "value": {"V0": 4}, "timestamp": 13},
        {"topic": "left", "key": 1, "value": {"k": 0, "V0": 5}, "timestamp": 100000},
        {"topic": "right", "key": 0, "value": {"V0": 6}, "timestamp": 100001}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": 2, "T3_V0": 3}, "timestamp": 12},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": 4, "T3_V0": 3}, "timestamp": 13},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 5, "S2_V0": 6, "T3_V0": 3}, "timestamp": 100001}
      ],
      "post": {
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "K INT KEY, S1_V0 BIGINT, S2_V0 BIGINT, T3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "stream-stream-table - inner-inner - rekey left and right",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, k int, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE STREAM S2 (ID INT KEY, k int, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT T3.ID, s1.V0, s2.V0, t3.V0 FROM S1 JOIN S2 WITHIN 10 seconds ON S1.K = S2.K JOIN T3 ON S1.K = T3.ID;"
      ],
      "inputs": [
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 10},
        {"topic": "right", "key": 2, "value": {"k": 0, "V0": 2}, "timestamp": 11},
        {"topic": "left", "key": 1, "value": {"k": 0, "V0": 1}, "timestamp": 12},
        {"topic": "right", "key": 2, "value": {"k":0, "V0": 4}, "timestamp": 13},
        {"topic": "left", "key": 1, "value": {"k": 0, "V0": 5}, "timestamp": 100000},
        {"topic": "right", "key": 2, "value": {"k": 0, "V0": 6}, "timestamp": 100001}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": 2, "T3_V0": 3}, "timestamp": 12},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": 4, "T3_V0": 3}, "timestamp": 13},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 5, "S2_V0": 6, "T3_V0": 3}, "timestamp": 100001}
      ],
      "post": {
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "T3_ID INT KEY, S1_V0 BIGINT, S2_V0 BIGINT, T3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "stream-stream-table - inner-inner - cascading join criteria",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, k int, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE STREAM S2 (ID INT KEY, k int, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT s1.k, s1.V0, s2.V0, t3.V0 FROM S1 JOIN S2 WITHIN 10 seconds ON S1.K = S2.K JOIN T3 ON S2.K = T3.ID;"
      ],
      "inputs": [
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 10},
        {"topic": "right", "key": 2, "value": {"k": 0, "V0": 2}, "timestamp": 11},
        {"topic": "left", "key": 1, "value": {"k": 0, "V0": 1}, "timestamp": 12},
        {"topic": "right", "key": 2, "value": {"k":0, "V0": 4}, "timestamp": 13},
        {"topic": "left", "key": 1, "value": {"k": 0, "V0": 5}, "timestamp": 100000},
        {"topic": "right", "key": 2, "value": {"k": 0, "V0": 6}, "timestamp": 100001}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": 2, "T3_V0": 3}, "timestamp": 12},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": 4, "T3_V0": 3}, "timestamp": 13},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 5, "S2_V0": 6, "T3_V0": 3}, "timestamp": 100001}
      ],
      "post": {
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "S1_K INT KEY, S1_V0 BIGINT, S2_V0 BIGINT, T3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "stream-stream-table - left-inner",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE STREAM S2 (ID INT KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT s1.V0, s2.V0, t3.V0, S2.ID FROM S1 LEFT JOIN S2 WITHIN 10 seconds ON S1.ID = S2.ID JOIN T3 ON S1.ID = T3.ID;"
      ],
      "inputs": [
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 10},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 11},
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 12},
        {"topic": "right", "key": 0, "value": {"V0": 4}, "timestamp": 13},
        {"topic": "left", "key": 0, "value": {"V0": 5}, "timestamp": 100000},
        {"topic": "right", "key": 0, "value": {"V0": 6}, "timestamp": 100001}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": 2, "T3_V0": 3}, "timestamp": 12},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": 4, "T3_V0": 3}, "timestamp": 13},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 5, "S2_V0": null, "T3_V0": 3}, "timestamp": 100000},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 5, "S2_V0": 6, "T3_V0": 3}, "timestamp": 100001}
      ],
      "post": {
        "topics": {"blacklist": ".*-repartition"},
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "S2_ID INT KEY, S1_V0 BIGINT, S2_V0 BIGINT, T3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "stream-stream-table - full-inner",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE STREAM S2 (ID INT KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT S1.ID, s1.V0, s2.V0, t3.V0 FROM S1 FULL JOIN S2 WITHIN 10 seconds ON S1.ID = S2.ID JOIN T3 ON S1.ID = T3.ID;"
      ],
      "inputs": [
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 10},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 11},
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 12},
        {"topic": "right", "key": 0, "value": {"V0": 4}, "timestamp": 13},
        {"topic": "left", "key": 0, "value": {"V0": 5}, "timestamp": 100000},
        {"topic": "right", "key": 0, "value": {"V0": 6}, "timestamp": 100001}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": 2, "T3_V0": 3}, "timestamp": 12},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": 4, "T3_V0": 3}, "timestamp": 13},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 5, "S2_V0": null, "T3_V0": 3}, "timestamp": 100000},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 5, "S2_V0": 6, "T3_V0": 3}, "timestamp": 100001}
      ],
      "post": {
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "S1_ID INT KEY, S1_V0 BIGINT, S2_V0 BIGINT, T3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "stream-stream-table - full-inner - select *",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE STREAM S2 (ID INT KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT * FROM S1 FULL JOIN S2 WITHIN 10 seconds ON S1.ID = S2.ID JOIN T3 ON S1.ID = T3.ID;"
      ],
      "inputs": [
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 10},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 11},
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 12},
        {"topic": "right", "key": 0, "value": {"V0": 4}, "timestamp": 13},
        {"topic": "left", "key": 0, "value": {"V0": 5}, "timestamp": 100000},
        {"topic": "right", "key": 0, "value": {"V0": 6}, "timestamp": 100001}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_ID": 0, "S2_V0": 2, "T3_ID": 0, "T3_V0": 3}, "timestamp": 12},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_ID": 0, "S2_V0": 4, "T3_ID": 0, "T3_V0": 3}, "timestamp": 13},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 5, "S2_ID": null, "S2_V0": null, "T3_ID": 0, "T3_V0": 3}, "timestamp": 100000},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 5, "S2_ID": 0, "S2_V0": 6, "T3_ID": 0, "T3_V0": 3}, "timestamp": 100001}
      ],
      "post": {
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "S1_ID INT KEY, S1_V0 BIGINT, S2_ID INT, S2_V0 BIGINT, T3_ID INT, T3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "stream-table-stream - inner-inner",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE STREAM S3 (ID INT KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT S3.ID, s1.V0, t2.V0, s3.V0 FROM S1 JOIN T2 ON S1.ID = T2.ID JOIN S3 WITHIN 10 seconds ON S1.ID = S3.ID;"
      ],
      "inputs": [
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 10},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 11},
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 12},
        {"topic": "right", "key": 0, "value": {"V0": 4}, "timestamp": 13},
        {"topic": "left", "key": 0, "value": {"V0": 5}, "timestamp": 100000},
        {"topic": "right2", "key": 0, "value": {"V0": 6}, "timestamp": 100001}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "T2_V0": 2, "S3_V0": 3}, "timestamp": 12},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 5, "T2_V0": 4, "S3_V0": 6}, "timestamp": 100001}
      ],
      "post": {
        "topics": {"blacklist": ".*-repartition"},
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "S3_ID INT KEY, S1_V0 BIGINT, T2_V0 BIGINT, S3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "stream-table-stream - left-inner",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE STREAM S3 (ID INT KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT S3.ID, s1.V0, t2.V0, s3.V0 FROM S1 LEFT JOIN T2 ON S1.ID = T2.ID JOIN S3 WITHIN 10 seconds ON S1.ID = S3.ID;"
      ],
      "inputs": [
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 10},
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 12},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 11},
        {"topic": "right", "key": 0, "value": {"V0": 4}, "timestamp": 13},
        {"topic": "left", "key": 0, "value": {"V0": 5}, "timestamp": 100000},
        {"topic": "right2", "key": 0, "value": {"V0": 6}, "timestamp": 100001}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "T2_V0": null, "S3_V0": 3}, "timestamp": 12},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 5, "T2_V0": 4, "S3_V0": 6}, "timestamp": 100001}
      ],
      "post": {
        "topics": {"blacklist": ".*-repartition"},
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "S3_ID INT KEY, S1_V0 BIGINT, T2_V0 BIGINT, S3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "stream-stream-stream - outer-outer",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE STREAM S2 (ID INT KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE STREAM S3 (ID INT KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT ROWKEY, s1.V0, s2.V0, s3.V0 FROM S1 FULL OUTER JOIN S2 WITHIN 5 seconds ON S1.ID = S2.ID FULL OUTER JOIN S3 WITHIN 10 seconds ON S1.ID = S3.ID;"
      ],
      "inputs": [
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 0},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 1},
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 2},
        {"topic": "left", "key": 0, "value": {"V0": 4}, "timestamp": 3}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": null, "S3_V0": null}, "timestamp": 0},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": 2, "S3_V0": null}, "timestamp": 1},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": null, "S3_V0": 3}, "timestamp": 2},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": 2, "S3_V0": 3}, "timestamp": 2},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 4, "S2_V0": 2, "S3_V0": 3}, "timestamp": 3}
      ],
      "post": {
        "topics": {
          "topics" : [
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-Join-left-repartition",
              "keyFormat" : {"format" : "KAFKA"},
              "valueFormat" : {"format" : "JSON"}
            }
          ]
        },
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "ROWKEY INT KEY, S1_V0 BIGINT, S2_V0 BIGINT, S3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "stream-stream-stream - left-left",
      "statements": [
        "CREATE STREAM s1 (id INT KEY, v0 BIGINT) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE STREAM s2 (id INT KEY, v0 BIGINT) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE STREAM s3 (id INT KEY, v0 BIGINT) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM output AS SELECT s2.id, s1.v0, s2.v0, s3.v0 FROM s1 LEFT JOIN s2 WITHIN 5 SECONDS ON s1.id = s2.id LEFT JOIN S3 WITHIN 10 SECONDS ON s1.id = s3.id;"
      ],
      "inputs": [
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 0},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 1},
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 2},
        {"topic": "left", "key": 0, "value": {"V0": 4}, "timestamp": 3}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": null, "S3_V0": null}, "timestamp": 0},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": 2, "S3_V0": null}, "timestamp": 1},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": null, "S3_V0": 3}, "timestamp": 2},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": 2, "S3_V0": 3}, "timestamp": 2},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 4, "S2_V0": 2, "S3_V0": 3}, "timestamp": 3}
      ],
      "post": {
        "topics": {"blacklist": ".*-repartition"},
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "S2_ID INT KEY, S1_V0 BIGINT, S2_V0 BIGINT, S3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "stream-stream-stream - inner-inner - different windows",
      "statements": [
        "CREATE STREAM s1 (id INT KEY, v0 BIGINT) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE STREAM s2 (id INT KEY, v0 BIGINT) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE STREAM s3 (id INT KEY, v0 BIGINT) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM output AS SELECT s2.id, s1.v0, s2.v0, s3.v0 FROM S1 JOIN S2 WITHIN 5 SECONDS ON s1.id = s2.id JOIN S3 WITHIN 10 SECONDS ON s1.id = s3.id;"
      ],
      "inputs": [
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 0},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 1},
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 2},
        {"topic": "left", "key": 0, "value": {"V0": 4}, "timestamp": 3},
        {"topic": "left", "key": 0, "value": {"V0": 5}, "timestamp": 4000},
        {"topic": "right2", "key": 0, "value": {"V0": 6}, "timestamp": 6000},
        {"topic": "left", "key": 0, "value": {"V0": 7}, "timestamp": 6001},
        {"topic": "right2", "key": 0, "value": {"V0": 8}, "timestamp": 7000}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": 2, "S3_V0": 3}, "timestamp": 2},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 4, "S2_V0": 2, "S3_V0": 3}, "timestamp": 3},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 5, "S2_V0": 2, "S3_V0": 3}, "timestamp": 4000},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": 2, "S3_V0": 6}, "timestamp": 6000},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 4, "S2_V0": 2, "S3_V0": 6}, "timestamp": 6000},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 5, "S2_V0": 2, "S3_V0": 6}, "timestamp": 6000},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": 2, "S3_V0": 8}, "timestamp": 7000},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 4, "S2_V0": 2, "S3_V0": 8}, "timestamp": 7000},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 5, "S2_V0": 2, "S3_V0": 8}, "timestamp": 7000}
      ],
      "post": {
        "topics": {"blacklist": ".*-repartition"},
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "S2_ID INT KEY, S1_V0 BIGINT, S2_V0 BIGINT, S3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "table-table-table - key format mismatch",
      "statements": [
        "CREATE TABLE T1 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='left', key_format='KAFKA', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', key_format='KAFKA', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', key_format='DELIMITED', value_format='JSON');",
        "CREATE TABLE OUTPUT as SELECT T1.ID, T1.V0, T2.V0, T3.V0 FROM T1 JOIN T2 ON T1.ID = T2.ID JOIN T3 ON T1.ID = T3.ID;"
      ],
      "inputs": [
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 0},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 1},
        {"topic": "right2", "key": "0", "value": {"V0": 3}, "timestamp": 2},
        {"topic": "left", "key": 0, "value": {"V0": 4}, "timestamp": 1000}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"T1_V0": 1, "T2_V0": 2, "T3_V0": 3}, "timestamp": 2},
        {"topic": "OUTPUT", "key": 0, "value": {"T1_V0": 4, "T2_V0": 2, "T3_V0": 3}, "timestamp": 1000}
      ]
    },
    {
      "name": "table-table-table - inner-inner",
      "statements": [
        "CREATE TABLE T1 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE TABLE OUTPUT as SELECT T1.ID, T1.V0, T2.V0, T3.V0 FROM T1 JOIN T2 ON T1.ID = T2.ID JOIN T3 ON T1.ID = T3.ID;"
      ],
      "inputs": [
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 0},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 1},
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 2},
        {"topic": "left", "key": 0, "value": {"V0": 4}, "timestamp": 1000}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"T1_V0": 1, "T2_V0": 2, "T3_V0": 3}, "timestamp": 2},
        {"topic": "OUTPUT", "key": 0, "value": {"T1_V0": 4, "T2_V0": 2, "T3_V0": 3}, "timestamp": 1000}
      ],
      "post": {
        "topics": {"blacklist": ".*-repartition"},
        "sources": [
          {"name": "OUTPUT", "type": "table", "schema": "T1_ID INT PRIMARY KEY, T1_V0 BIGINT, T2_V0 BIGINT, T3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "table-table-table - inner-full",
      "statements": [
        "CREATE TABLE T1 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE TABLE OUTPUT as SELECT ROWKEY AS ID, T1.V0, T2.V0, T3.V0 FROM T1 JOIN T2 ON T1.ID = T2.ID FULL JOIN T3 ON T1.ID = T3.ID;"
      ],
      "inputs": [
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 0},
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 2},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 3},
        {"topic": "left", "key": 0, "value": {"V0": 4}, "timestamp": 1000}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"T1_V0": null, "T2_V0": null, "T3_V0": 3}, "timestamp": 2},
        {"topic": "OUTPUT", "key": 0, "value": {"T1_V0": 1, "T2_V0": 2, "T3_V0": 3}, "timestamp": 3},
        {"topic": "OUTPUT", "key": 0, "value": {"T1_V0": 4, "T2_V0": 2, "T3_V0": 3}, "timestamp": 1000}
      ],
      "post": {
        "topics": {"blacklist": ".*-repartition"},
        "sources": [
          {"name": "OUTPUT", "type": "table", "schema": "ID INT PRIMARY KEY, T1_V0 BIGINT, T2_V0 BIGINT, T3_V0 BIGINT"}
        ]
      }
    },
    {
      "name": "self join with multiple sources",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left_topic', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right_topic', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right_topic', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT * FROM S1 JOIN T2 ON S1.V0 = T2.V0 JOIN T3 ON S1.V0 = S1.V0;"
      ],
      "expectedException": {
        "type": "io.confluent.ksql.util.KsqlException",
        "message": "Each side of the join must reference exactly one source and not the same source. Left side references `S1` and right references `S1`"
      }
    },
    {
      "name": "criteria that does not use the joined source",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left_topic', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right_topic', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right_topic', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT * FROM S1 JOIN T2 ON S1.ID = T2.ID JOIN T3 ON S1.ID = T2.ID;"
      ],
      "expectedException": {
        "type": "io.confluent.ksql.util.KsqlException",
        "message": "A join criteria is expected to reference the source (`T3`) in the FROM clause, instead the right source references `T2` and the left source references `S1`"
      }
    },
    {
      "name": "table-table-stream - Invalid",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left_topic', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right_topic', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right_topic', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT * FROM T2 JOIN T3 ON T2.ID = T3.ID JOIN S1 ON T2.ID = S1.ID;"
      ],
      "expectedException": {
        "type": "io.confluent.ksql.util.KsqlException",
        "message": "Invalid join order: table-stream joins are not supported; only stream-table joins. Got T2 [INNER] JOIN S1."
      }
    },
    {
      "name": "should generate correct aliases when sources have some matching and some different columns",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, DIFF bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT S1.ID, s1.V0, t2.V0, t3.DIFF FROM S1 JOIN T2 ON S1.ID = T2.ID JOIN T3 ON S1.ID = T3.ID;"
      ],
      "inputs": [
        {"topic": "right2", "key": 0, "value": {"diff": 3}, "timestamp": 10},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 11},
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 12},
        {"topic": "left", "key": 1, "value": {"V0": 1}, "timestamp": 14}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "T2_V0": 2, "DIFF": 3}, "timestamp": 12}
      ],
      "post": {
        "topics": {"blacklist": ".*-repartition"},
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "S1_ID INT KEY, S1_V0 BIGINT, T2_V0 BIGINT, DIFF BIGINT"}
        ]
      }
    },
    {
      "name": "join on literal",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, DIFF bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT S1.ID, s1.V0, t2.V0, t3.DIFF FROM S1 JOIN T2 ON S1.ID = 0 JOIN T3 ON S1.ID = T3.ID;"
      ],
       "expectedException": {
        "type": "io.confluent.ksql.util.KsqlStatementException",
        "message": "Invalid comparison expression '0' in join '(S1.ID = 0)'. Each side of the join comparision must contain references from exactly one source."
      }
    },
    {
      "name": "partition count mismatch",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON', PARTITIONS=1);",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON', PARTITIONS=1);",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON', PARTITIONS=2);",
        "CREATE STREAM OUTPUT as SELECT * FROM S1 JOIN T2 ON S1.ID = T2.ID JOIN T3 ON S1.ID = T3.ID;"
      ],
      "expectedException": {
        "type": "io.confluent.ksql.util.KsqlStatementException",
        "message": "Can't join `S1` with `T3` since the number of partitions don't match. `S1` partitions = 1; `T3` partitions = 2. Please repartition either one so that the number of partitions match."
      }
    },
    {
      "name": "scoped include all columns",
      "statements": [
        "CREATE STREAM S1 (A INT KEY, B INT) WITH (kafka_topic='S1', value_format='JSON');",
        "CREATE STREAM S2 (A INT KEY, B INT) WITH (kafka_topic='S2', value_format='JSON');",
        "CREATE STREAM S3 (A INT KEY, B INT) WITH (kafka_topic='S3', value_format='JSON');",
        "CREATE STREAM OUTPUT AS SELECT s1.*, s2.*, s3.* FROM S1 INNER JOIN S2 WITHIN 10 SECONDS ON S1.A = S2.A INNER JOIN S3 WITHIN 10 SECONDS ON S1.A = S3.A WHERE S1.B < 5;"
      ],
      "inputs": [
        {"topic": "S1", "key": 0, "value": {"B": 1}, "timestamp": 10},
        {"topic": "S2", "key": 0, "value": {"B": -1}, "timestamp": 11},
        {"topic": "S3", "key": 0, "value": {"B": 9}, "timestamp": 12},
        {"topic": "S1", "key": 0, "value": {"B": 9}, "timestamp": 13}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_B": 1, "S2_A": 0, "S2_B": -1, "S3_A": 0, "S3_B": 9}, "timestamp":  12}
      ]
    },
    {
      "name": "duplicate source",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left_topic', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right_topic', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right_topic', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT * FROM S1 JOIN T2 ON S1.ID = T2.ID JOIN T2 ON S1.V0 = T2.V0;"
      ],
      "expectedException": {
        "type": "io.confluent.ksql.util.KsqlException",
        "message": "N-way joins do not support multiple occurrences of the same source. Source: 'T2'"
      }
    },
    {
      "name": "stream-stream-stream - SR-enabled key format",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', key_format='JSON_SR', value_format='JSON');",
        "CREATE STREAM S2 (ID INT KEY, V0 bigint) WITH (kafka_topic='right', key_format='AVRO', value_format='JSON');",
        "CREATE STREAM S3 (ID INT KEY, V0 bigint) WITH (kafka_topic='right2', key_format='AVRO', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT S2.ID, s1.V0, s2.V0, s3.V0 FROM S1 JOIN S2 WITHIN 5 seconds ON S1.ID = S2.ID JOIN S3 WITHIN 10 seconds ON S1.ID = S3.ID;"
      ],
      "inputs": [
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 0},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 1},
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 2},
        {"topic": "left", "key": 0, "value": {"V0": 4}, "timestamp": 3},
        {"topic": "left", "key": 0, "value": {"V0": 5}, "timestamp": 4000},
        {"topic": "right2", "key": 0, "value": {"V0": 6}, "timestamp": 6000},
        {"topic": "left", "key": 0, "value": {"V0": 7}, "timestamp": 6001},
        {"topic": "right2", "key": 0, "value": {"V0": 8}, "timestamp": 7000}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": 2, "S3_V0": 3}, "timestamp": 2},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 4, "S2_V0": 2, "S3_V0": 3}, "timestamp": 3},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 5, "S2_V0": 2, "S3_V0": 3}, "timestamp": 4000},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": 2, "S3_V0": 6}, "timestamp": 6000},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 4, "S2_V0": 2, "S3_V0": 6}, "timestamp": 6000},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 5, "S2_V0": 2, "S3_V0": 6}, "timestamp": 6000},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": 2, "S3_V0": 8}, "timestamp": 7000},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 4, "S2_V0": 2, "S3_V0": 8}, "timestamp": 7000},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 5, "S2_V0": 2, "S3_V0": 8}, "timestamp": 7000}
      ],
      "post": {
        "topics": {
          "topics" : [
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-L_Join-left-repartition",
              "keyFormat" : {"format" : "JSON_SR", "features": ["UNWRAP_SINGLES"]},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-L_Join-right-repartition",
              "keyFormat" : {"format" : "JSON_SR", "features": ["UNWRAP_SINGLES"]},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-Join-right-repartition",
              "keyFormat" : {"format" : "JSON_SR", "features": ["UNWRAP_SINGLES"]},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-KSTREAM-JOINTHIS-0000000016-store-changelog",
              "keyFormat" : {"format" : "JSON_SR", "features": ["UNWRAP_SINGLES"]},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-KSTREAM-JOINOTHER-0000000017-store-changelog",
              "keyFormat" : {"format" : "JSON_SR", "features": ["UNWRAP_SINGLES"]},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-KSTREAM-JOINTHIS-0000000028-store-changelog",
              "keyFormat" : {"format" : "JSON_SR", "features": ["UNWRAP_SINGLES"]},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-KSTREAM-JOINOTHER-0000000029-store-changelog",
              "keyFormat" : {"format" : "JSON_SR", "features": ["UNWRAP_SINGLES"]},
              "valueFormat" : {"format" : "JSON"}
            }
          ]
        }
      }
    },
    {
      "name": "stream-stream-stream - SR-enabled key format - rekey",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 INT) WITH (kafka_topic='left', key_format='JSON_SR', value_format='JSON');",
        "CREATE STREAM S2 (ID INT KEY, V0 INT) WITH (kafka_topic='right', key_format='AVRO', value_format='JSON');",
        "CREATE STREAM S3 (ID INT KEY, V0 INT) WITH (kafka_topic='right2', key_format='AVRO', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT S2.ID, s1.V0, s2.V0, s3.V0 FROM S1 JOIN S2 WITHIN 5 seconds ON S1.ID = S2.ID JOIN S3 WITHIN 10 seconds ON S1.V0 = S3.V0;"
      ],
      "inputs": [
        {"topic": "left", "key": 0, "value": {"V0": 3}, "timestamp": 0},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 1},
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 2}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 3, "value": {"S2_ID": 0, "S2_V0": 2, "S3_V0": 3}, "timestamp": 2}
      ],
      "post": {
        "topics": {
          "topics" : [
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-L_Join-left-repartition",
              "keyFormat" : {"format" : "JSON_SR", "features": ["UNWRAP_SINGLES"]},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-L_Join-right-repartition",
              "keyFormat" : {"format" : "JSON_SR", "features": ["UNWRAP_SINGLES"]},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-Join-left-repartition",
              "keyFormat" : {"format" : "JSON_SR", "features": ["UNWRAP_SINGLES"]},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-Join-right-repartition",
              "keyFormat" : {"format" : "JSON_SR", "features": ["UNWRAP_SINGLES"]},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-KSTREAM-JOINTHIS-0000000016-store-changelog",
              "keyFormat" : {"format" : "JSON_SR", "features": ["UNWRAP_SINGLES"]},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-KSTREAM-JOINOTHER-0000000017-store-changelog",
              "keyFormat" : {"format" : "JSON_SR", "features": ["UNWRAP_SINGLES"]},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-KSTREAM-JOINTHIS-0000000032-store-changelog",
              "keyFormat" : {"format" : "JSON_SR", "features": ["UNWRAP_SINGLES"]},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-KSTREAM-JOINOTHER-0000000033-store-changelog",
              "keyFormat" : {"format" : "JSON_SR", "features": ["UNWRAP_SINGLES"]},
              "valueFormat" : {"format" : "JSON"}
            }
          ]
        }
      }
    },
    {
      "name": "stream-stream-table - SR-enabled key format",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 bigint) WITH (kafka_topic='left', key_format='AVRO', value_format='JSON');",
        "CREATE STREAM S2 (ID INT KEY, V0 bigint) WITH (kafka_topic='right', key_format='JSON_SR', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', key_format='JSON_SR', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT S2.ID, s1.V0, s2.V0, t3.V0 FROM S1 JOIN S2 WITHIN 10 seconds ON S1.ID = S2.ID JOIN T3 ON S1.ID = T3.ID;"
      ],
      "inputs": [
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 10},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 11},
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 12},
        {"topic": "right", "key": 0, "value": {"V0": 4}, "timestamp": 13},
        {"topic": "left", "key": 0, "value": {"V0": 5}, "timestamp": 100000},
        {"topic": "right", "key": 0, "value": {"V0": 6}, "timestamp": 100001}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": 2, "T3_V0": 3}, "timestamp": 12},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 1, "S2_V0": 4, "T3_V0": 3}, "timestamp": 13},
        {"topic": "OUTPUT", "key": 0, "value": {"S1_V0": 5, "S2_V0": 6, "T3_V0": 3}, "timestamp": 100001}
      ],
      "post": {
        "topics": {
          "topics" : [
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-L_Join-left-repartition",
              "keyFormat" : {"format" : "AVRO", "features": ["UNWRAP_SINGLES"], "properties": {"fullSchemaName": "io.confluent.ksql.avro_schemas.S1Key"}},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-L_Join-right-repartition",
              "keyFormat" : {"format" : "AVRO", "features": ["UNWRAP_SINGLES"], "properties": {"fullSchemaName": "io.confluent.ksql.avro_schemas.S1Key"}},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-RightSourceKeyed-SelectKey-repartition",
              "keyFormat" : {"format" : "AVRO", "features": ["UNWRAP_SINGLES"], "properties": {"fullSchemaName": "io.confluent.ksql.avro_schemas.S1Key"}},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-KSTREAM-JOINTHIS-0000000028-store-changelog",
              "keyFormat" : {"format" : "AVRO", "features": ["UNWRAP_SINGLES"], "properties": {"fullSchemaName": "io.confluent.ksql.avro_schemas.S1Key"}},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-KSTREAM-JOINOTHER-0000000029-store-changelog",
              "keyFormat" : {"format" : "AVRO", "features": ["UNWRAP_SINGLES"], "properties": {"fullSchemaName": "io.confluent.ksql.avro_schemas.S1Key"}},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-RightSourceKeyed-Materialize-changelog",
              "keyFormat" : {"format" : "AVRO", "features": ["UNWRAP_SINGLES"], "properties": {"fullSchemaName": "io.confluent.ksql.avro_schemas.S1Key"}},
              "valueFormat" : {"format" : "JSON"}
            }
          ]
        }
      }
    },
    {
      "name": "stream-stream-table - SR-enabled key format - rekey - differing internal key formats",
      "statements": [
        "CREATE STREAM S1 (ID INT KEY, V0 INT) WITH (kafka_topic='left', key_format='AVRO', value_format='JSON');",
        "CREATE STREAM S2 (ID INT KEY, V0 INT) WITH (kafka_topic='right', key_format='JSON_SR', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', key_format='JSON_SR', value_format='JSON');",
        "CREATE STREAM OUTPUT as SELECT S2.ID, s1.V0, s2.V0, t3.V0 FROM S1 JOIN S2 WITHIN 10 seconds ON S1.ID = S2.ID JOIN T3 ON S1.V0 = T3.ID;"
      ],
      "inputs": [
        {"topic": "right2", "key": 1, "value": {"V0": 3}, "timestamp": 10},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 11},
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 12}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 1, "value": {"S2_ID": 0, "S2_V0": 2, "T3_V0": 3}, "timestamp": 12}
      ],
      "post": {
        "topics": {
          "topics" : [
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-L_Join-left-repartition",
              "keyFormat" : {"format" : "AVRO", "features": ["UNWRAP_SINGLES"], "properties": {"fullSchemaName": "io.confluent.ksql.avro_schemas.S1Key"}},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-L_Join-right-repartition",
              "keyFormat" : {"format" : "AVRO", "features": ["UNWRAP_SINGLES"], "properties": {"fullSchemaName": "io.confluent.ksql.avro_schemas.S1Key"}},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-Join-repartition",
              "keyFormat" : {"format" : "JSON_SR", "features": ["UNWRAP_SINGLES"]},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-RightSourceKeyed-SelectKey-repartition",
              "keyFormat" : {"format" : "JSON_SR", "features": ["UNWRAP_SINGLES"]},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-KSTREAM-JOINTHIS-0000000028-store-changelog",
              "keyFormat" : {"format" : "AVRO", "features": ["UNWRAP_SINGLES"], "properties": {"fullSchemaName": "io.confluent.ksql.avro_schemas.S1Key"}},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-KSTREAM-JOINOTHER-0000000029-store-changelog",
              "keyFormat" : {"format" : "AVRO", "features": ["UNWRAP_SINGLES"], "properties": {"fullSchemaName": "io.confluent.ksql.avro_schemas.S1Key"}},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CSAS_OUTPUT_0-RightSourceKeyed-Materialize-changelog",
              "keyFormat" : {"format" : "JSON_SR", "features": ["UNWRAP_SINGLES"]},
              "valueFormat" : {"format" : "JSON"}
            }
          ]
        }
      }
    },
    {
      "name": "table-table-table - SR-enabled key format",
      "statements": [
        "CREATE TABLE T1 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='left', key_format='AVRO', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', key_format='AVRO', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', key_format='AVRO', value_format='JSON');",
        "CREATE TABLE OUTPUT as SELECT ROWKEY AS ID, T1.V0, T2.V0, T3.V0 FROM T1 JOIN T2 ON T1.ID = T2.ID FULL JOIN T3 ON T1.ID = T3.ID;"
      ],
      "inputs": [
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 0},
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 2},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 3},
        {"topic": "left", "key": 0, "value": {"V0": 4}, "timestamp": 1000}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"T1_V0": null, "T2_V0": null, "T3_V0": 3}, "timestamp": 2},
        {"topic": "OUTPUT", "key": 0, "value": {"T1_V0": 1, "T2_V0": 2, "T3_V0": 3}, "timestamp": 3},
        {"topic": "OUTPUT", "key": 0, "value": {"T1_V0": 4, "T2_V0": 2, "T3_V0": 3}, "timestamp": 1000}
      ],
      "post": {
        "topics": {
          "topics" : [
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CTAS_OUTPUT_0-L_LeftSourceKeyed-SelectKey-repartition",
              "keyFormat" : {"format" : "AVRO", "features": ["UNWRAP_SINGLES"], "properties":{"fullSchemaName":"io.confluent.ksql.avro_schemas.T1Key"}},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CTAS_OUTPUT_0-L_RightSourceKeyed-SelectKey-repartition",
              "keyFormat" : {"format" : "AVRO", "features": ["UNWRAP_SINGLES"], "properties":{"fullSchemaName":"io.confluent.ksql.avro_schemas.T1Key"}},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CTAS_OUTPUT_0-RightSourceKeyed-SelectKey-repartition",
              "keyFormat" : {"format" : "AVRO", "features": ["UNWRAP_SINGLES"], "properties":{"fullSchemaName":"io.confluent.ksql.avro_schemas.T1Key"}},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CTAS_OUTPUT_0-L_LeftSourceKeyed-Materialize-changelog",
              "keyFormat" : {"format" : "AVRO", "features": ["UNWRAP_SINGLES"], "properties":{"fullSchemaName":"io.confluent.ksql.avro_schemas.T1Key"}},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CTAS_OUTPUT_0-L_RightSourceKeyed-Materialize-changelog",
              "keyFormat" : {"format" : "AVRO", "features": ["UNWRAP_SINGLES"], "properties":{"fullSchemaName":"io.confluent.ksql.avro_schemas.T1Key"}},
              "valueFormat" : {"format" : "JSON"}
            },
            {
              "name" : "_confluent-ksql-some.ksql.service.idquery_CTAS_OUTPUT_0-RightSourceKeyed-Materialize-changelog",
              "keyFormat" : {"format" : "AVRO", "features": ["UNWRAP_SINGLES"], "properties":{"fullSchemaName":"io.confluent.ksql.avro_schemas.T1Key"}},
              "valueFormat" : {"format" : "JSON"}
            }
          ]
        }
      }
    },
    {
      "name": "stream-table-table - qualified select *",
      "statements": [
        "CREATE STREAM left_stream (id1 BIGINT KEY, f1 BIGINT) WITH (kafka_topic='left_topic', format='JSON');",
        "CREATE TABLE middle_table (id2 BIGINT PRIMARY KEY, f2 BIGINT, other STRING) WITH (kafka_topic='middle_topic', format='JSON');",
        "CREATE TABLE right_table (id3 BIGINT PRIMARY KEY, f3 BIGINT) WITH (kafka_topic='right_topic', format='JSON');",
        "CREATE STREAM output AS SELECT id1, f1, middle_table.*, right_table.* FROM left_stream JOIN middle_table ON id1 = id2 LEFT JOIN right_table ON f1 = id3;"
      ],
      "inputs": [
        {"topic": "middle_topic", "key": 0, "value": {"F2": 100, "OTHER": "unused"}, "timestamp": 0},
        {"topic": "left_topic", "key": 0, "value": {"F1": 0}, "timestamp": 10000},
        {"topic": "right_topic", "key": 0, "value": {"F3": 4}, "timestamp": 11000},
        {"topic": "middle_topic", "key": 8, "value": {"F2": 10, "OTHER": "unused"}, "timestamp": 13000},
        {"topic": "left_topic", "key": 8, "value": {"F1": 8}, "timestamp": 16000},
        {"topic": "left_topic", "key": 0, "value": null, "timestamp": 18000}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"ID1": 0, "MIDDLE_TABLE_ID2": 0, "MIDDLE_TABLE_F2": 100, "MIDDLE_TABLE_OTHER": "unused", "RIGHT_TABLE_ID3": null, "RIGHT_TABLE_F3": null}, "timestamp": 10000},
        {"topic": "OUTPUT", "key": 8, "value": {"ID1": 8, "MIDDLE_TABLE_ID2": 8, "MIDDLE_TABLE_F2": 10, "MIDDLE_TABLE_OTHER": "unused", "RIGHT_TABLE_ID3": null, "RIGHT_TABLE_F3": null}, "timestamp": 16000}
      ],
      "post": {
        "sources": [
          {"name": "OUTPUT", "type": "stream", "schema": "F1 BIGINT KEY, ID1 BIGINT, MIDDLE_TABLE_ID2 BIGINT, MIDDLE_TABLE_F2 BIGINT, MIDDLE_TABLE_OTHER STRING, RIGHT_TABLE_ID3 BIGINT, RIGHT_TABLE_F3 BIGINT"}
        ]
      }
    },
    {
      "name": "table-table-table-table - qualified select *",
      "statements": [
        "CREATE TABLE T1 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='left', value_format='JSON');",
        "CREATE TABLE T2 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right', value_format='JSON');",
        "CREATE TABLE T3 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right2', value_format='JSON');",
        "CREATE TABLE T4 (ID INT PRIMARY KEY, V0 bigint) WITH (kafka_topic='right3', value_format='JSON');",
        "CREATE TABLE OUTPUT as SELECT T1.ID, T2.*, T3.V0, T4.* FROM T1 JOIN T2 ON T1.ID = T2.ID JOIN T3 ON T1.ID = T3.ID JOIN T4 ON T1.ID = T4.ID;"
      ],
      "inputs": [
        {"topic": "left", "key": 0, "value": {"V0": 1}, "timestamp": 0},
        {"topic": "right", "key": 0, "value": {"V0": 2}, "timestamp": 1},
        {"topic": "right2", "key": 0, "value": {"V0": 3}, "timestamp": 2},
        {"topic": "right3", "key": 0, "value": {"V0": 4}, "timestamp": 3}
      ],
      "outputs": [
        {"topic": "OUTPUT", "key": 0, "value": {"T2_ID": 0, "T2_V0": 2, "T3_V0": 3, "T4_ID": 0, "T4_V0": 4}, "timestamp": 3}
      ],
      "post": {
        "topics": {"blacklist": ".*-repartition"},
        "sources": [
          {"name": "OUTPUT", "type": "table", "schema": "T1_ID INT PRIMARY KEY, T2_ID INTEGER, T2_V0 BIGINT, T3_V0 BIGINT, T4_ID INTEGER, T4_V0 BIGINT"}
        ]
      }
    }
  ]
}