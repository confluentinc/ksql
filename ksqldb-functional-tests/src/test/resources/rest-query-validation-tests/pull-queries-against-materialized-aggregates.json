  {
  "comments": [
    "Tests covering Pull queries of (materialized) aggregate tables"
  ],
  "tests": [
    {
      "name": "non-windowed - select star and ROWTIME",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT ID, COUNT, ROWTIME FROM AGGREGATE WHERE ID='10';"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": "11", "value": {}},
        {"topic": "test_topic", "timestamp": 12365, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `COUNT` BIGINT, `ROWTIME` BIGINT"}},
          {"row":{"columns":["10", 1, 12365]}}
        ]}
      ]
    },
    {
      "name": "non-windowed single key lookup - STRING",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID='10';",
        "SELECT * FROM AGGREGATE WHERE ID='missing';"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": "11", "value": {}},
        {"topic": "test_topic", "timestamp": 12365, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `COUNT` BIGINT"}}
        ]}
      ]
    },
    {
      "name": "non-windowed single key lookup - INT",
      "statements": [
        "CREATE STREAM INPUT (ID INT KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID=10;",
        "SELECT * FROM AGGREGATE WHERE ID=123369;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": 11, "value": {}},
        {"topic": "test_topic", "timestamp": 12365, "key": 10, "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `COUNT` BIGINT"}}
        ]}
      ]
    },
    {
      "name": "non-windowed single key lookup - BIGINT",
      "statements": [
        "CREATE STREAM INPUT (ID BIGINT KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID=10;",
        "SELECT * FROM AGGREGATE WHERE ID=123369;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": 11, "value": {}},
        {"topic": "test_topic", "timestamp": 12365, "key": 10, "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` BIGINT KEY, `COUNT` BIGINT"}}
        ]}
      ]
    },
    {
      "name": "non-windowed single key lookup - DOUBLE",
      "statements": [
        "CREATE STREAM INPUT (ID DOUBLE KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID=10;",
        "SELECT * FROM AGGREGATE WHERE ID=1.0E1;",
        "SELECT * FROM AGGREGATE WHERE ID=123369;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": 11.0, "value": {}},
        {"topic": "test_topic", "timestamp": 12365, "key": 10.0, "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` DOUBLE KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10.0, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` DOUBLE KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10.0, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` DOUBLE KEY, `COUNT` BIGINT"}}
        ]}
      ]
    },
    {
      "name": "non-windowed lookup on wrong type",
      "statements": [
        "CREATE STREAM INPUT (ID INT KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID='10';"
      ],
      "expectedError": {
        "type": "io.confluent.ksql.rest.entity.KsqlStatementErrorMessage",
        "message": "Error in WHERE expression: Cannot compare ID (INTEGER) to '10' (STRING) with EQUAL.\nStatement: (ID = '10')",
        "status": 400
      }
    },
    {
      "name": "windowed - select star",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID='10';"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12346, "key": "11", "value": {"val": 1}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {"val": 2}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 12000, 13000, 1]}}
        ]}
      ]
    },
    {
      "name": "windowed - select star and ROWTIME",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT ID, WINDOWSTART, WINDOWEND, COUNT, ROWTIME FROM AGGREGATE WHERE ID='10';",
        "SELECT ID, WINDOWSTART, WINDOWEND, COUNT, ROWTIME FROM AGGREGATE WHERE ID='missing';"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12346, "key": "11", "value": {"val": 1}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {"val": 2}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT, `ROWTIME` BIGINT"}},
          {"row":{"columns":["10", 12000, 13000, 1, 12345]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT, `ROWTIME` BIGINT"}}
        ]}
      ]
    },
    {
      "name": "windowed single key lookup - STRING",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID='10';",
        "SELECT * FROM AGGREGATE WHERE ID='missing';"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12346, "key": "11", "value": {"val": 1}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {"val": 2}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 12000, 13000, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}}
        ]}
      ]
    },
    {
      "name": "windowed single key lookup - INT",
      "statements": [
        "CREATE STREAM INPUT (ID INT KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID=10;",
        "SELECT * FROM AGGREGATE WHERE ID=0;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12346, "key": 11, "value": {"val": 1}},
        {"topic": "test_topic", "timestamp": 12345, "key": 10, "value": {"val": 2}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10, 12000, 13000, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}}
        ]}
      ]
    },
    {
      "name": "windowed single key lookup - BIGINT",
      "statements": [
        "CREATE STREAM INPUT (ID BIGINT KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID=10;",
        "SELECT * FROM AGGREGATE WHERE ID=0;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12346, "key": 11, "value": {"val": 1}},
        {"topic": "test_topic", "timestamp": 12345, "key": 10, "value": {"val": 2}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` BIGINT KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10, 12000, 13000, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` BIGINT KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}}
        ]}
      ]
    },
    {
      "name": "windowed single key lookup - DOUBLE",
      "statements": [
        "CREATE STREAM INPUT (ID DOUBLE KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID=10.5;",
        "SELECT * FROM AGGREGATE WHERE ID=0;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12346, "key": 11.5, "value": {"val": 1}},
        {"topic": "test_topic", "timestamp": 12345, "key": 10.5, "value": {"val": 2}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` DOUBLE KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10.5, 12000, 13000, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` DOUBLE KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}}
        ]}
      ]
    },
    {
      "name": "windowed lookup on wrong type",
      "statements": [
        "CREATE STREAM INPUT (ID INT KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID='10';"
      ],
      "expectedError": {
        "type": "io.confluent.ksql.rest.entity.KsqlStatementErrorMessage",
        "message": "Error in WHERE expression: Cannot compare ID (INTEGER) to '10' (STRING) with EQUAL.\nStatement: (ID = '10')",
        "status": 400
      }
    },
    {
      "name": "tumbling windowed single key lookup with exact window start",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE ID='10' AND WindowStart=12000;",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE ID='10' AND WindowStart=13000;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": "11", "value": {}},
        {"topic": "test_topic", "timestamp": 11345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 12000, 13000, 12345, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}}
        ]}
      ]
    },
    {
      "name": "hopping windowed single key lookup with exact window start",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW HOPPING(SIZE 10 SECOND, ADVANCE BY 1 SECONDS) GROUP BY ID;",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE ID='10' AND WindowStart=12000;",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE ID='10' AND WindowStart=13000;",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE ID='10' AND WindowStart=14000;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 10345, "key": "11", "value": {}},
        {"topic": "test_topic", "timestamp": 10345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 13345, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 12000, 22000, 13345, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 13000, 23000, 13345, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}}
        ]}
      ]
    },
    {
      "name": "session windowed single key lookup with exact window start",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW SESSION(10 SECOND) GROUP BY ID;",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE ID='10' AND WindowStart=12345;",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE ID='10' AND WindowStart=12000;",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE ID='10' AND WindowStart=13000;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": "11", "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 12366, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 12345, 12366, 12366, 2]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}}
        ]}
      ]
    },
    {
      "name": "tumbling windowed single key lookup with window start range",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE 100 <= WindowStart AND WindowStart < 200000 AND ID='10';",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE 12000 <= WindowStart AND WindowStart < 14000 AND ID='10';",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE 12000 < WindowStart AND WindowStart <= 14000 AND ID='10';",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE WindowStart > 17000 AND 11234756356 > WindowStart AND ID='10';"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12001, "key": "11", "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 12211, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 14253, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 15364, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 12000, 13000, 12345, 2]}},
          {"row":{"columns":["10", 14000, 15000, 14253, 1]}},
          {"row":{"columns":["10", 15000, 16000, 15364, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 12000, 13000, 12345, 2]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 14000, 15000, 14253, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}}
        ]}
      ]
    },
    {
      "name": "tumbling windowed single key lookup with window start-end range",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE 100 <= WindowStart AND WindowEnd < 200000 AND ID='10';",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE 12000 <= WindowStart AND WindowEnd < 14000 AND ID='10';",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE 12000 < WindowStart AND WindowEnd <= 15000 AND ID='10';",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE WindowStart > 17000 AND 11234756356 > WindowEnd AND ID='10';"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12001, "key": "11", "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 12211, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 14253, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 15364, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 12000, 13000, 12345, 2]}},
          {"row":{"columns":["10", 14000, 15000, 14253, 1]}},
          {"row":{"columns":["10", 15000, 16000, 15364, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 12000, 13000, 12345, 2]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 14000, 15000, 14253, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}}
        ]}
      ]
    },
    {
      "name": "hopping windowed single key lookup with window start range",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW HOPPING(SIZE 5 SECOND, ADVANCE BY 1 SECONDS) GROUP BY ID;",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE ID='10' AND 7000 <= WindowStart AND WindowStart < 11000;",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE ID='10' AND 7000 < WindowStart AND WindowStart <= 11000;",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE ID='10' AND 13001 <= WindowStart AND WindowStart < 11234756356;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 10021, "key": "11", "value": {}},
        {"topic": "test_topic", "timestamp": 10345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 13251, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 7000, 12000, 10345, 1]}},
          {"row":{"columns":["10", 8000, 13000, 10345, 1]}},
          {"row":{"columns":["10", 9000, 14000, 13251, 2]}},
          {"row":{"columns":["10", 10000, 15000, 13251, 2]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 8000, 13000, 10345, 1]}},
          {"row":{"columns":["10", 9000, 14000, 13251, 2]}},
          {"row":{"columns":["10", 10000, 15000, 13251, 2]}},
          {"row":{"columns":["10", 11000, 16000, 13251, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}}
        ]}
      ]
    },
    {
      "name": "hopping windowed single key lookup with window start-end range",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW HOPPING(SIZE 5 SECOND, ADVANCE BY 1 SECONDS) GROUP BY ID;",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE ID='10' AND 7000 <= WindowStart AND WindowEnd < 16000;",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE ID='10' AND 7000 < WindowStart AND WindowEnd <= 16000;",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE ID='10' AND 13001 <= WindowStart AND WindowEnd < 11234756356;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 10021, "key": "11", "value": {}},
        {"topic": "test_topic", "timestamp": 10345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 13251, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 7000, 12000, 10345, 1]}},
          {"row":{"columns":["10", 8000, 13000, 10345, 1]}},
          {"row":{"columns":["10", 9000, 14000, 13251, 2]}},
          {"row":{"columns":["10", 10000, 15000, 13251, 2]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 8000, 13000, 10345, 1]}},
          {"row":{"columns":["10", 9000, 14000, 13251, 2]}},
          {"row":{"columns":["10", 10000, 15000, 13251, 2]}},
          {"row":{"columns":["10", 11000, 16000, 13251, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}}
        ]}
      ]
    },
    {
      "name": "session windowed single key lookup with window start range",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW SESSION(5 SECOND) GROUP BY ID;",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE ID='10' AND 10 <= WindowStart AND WindowStart < 200000;",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE ID='10' AND 8001 <= WindowStart AND WindowStart < 19444;",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE ID='10' AND 8001 < WindowStart AND WindowStart <= 19444;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": "11", "value": {}},
        {"topic": "test_topic", "timestamp": 8001, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 10456, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 19444, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 8001, 10456, 10456, 2]}},
          {"row":{"columns":["10", 19444, 19444, 19444, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 8001, 10456, 10456, 2]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 19444, 19444, 19444, 1]}}
        ]}
      ]
    },
    {
      "name": "session windowed single key lookup with window start-end range",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW SESSION(5 SECOND) GROUP BY ID;",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE ID='10' AND 10 <= WindowStart AND WindowEnd < 200000;",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE ID='10' AND 8001 <= WindowStart AND WindowEnd < 19444;",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE ID='10' AND 8001 < WindowStart AND WindowEnd <= 19444;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": "11", "value": {}},
        {"topic": "test_topic", "timestamp": 8001, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 10456, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 19444, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 8001, 10456, 10456, 2]}},
          {"row":{"columns":["10", 19444, 19444, 19444, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 8001, 10456, 10456, 2]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 19444, 19444, 19444, 1]}}
        ]}
      ]
    },
    {
      "name": "tumbling windowed single key lookup without window bounds",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE ID='10';"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": "11", "value": {}},
        {"topic": "test_topic", "timestamp": 11345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 11000, 12000, 11345, 1]}},
          {"row":{"columns":["10", 12000, 13000, 12345, 1]}}
        ]}
      ]
    },
    {
      "name": "hopping windowed single key lookup without window bounds",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW HOPPING(SIZE 4 SECOND, ADVANCE BY 1 SECONDS) GROUP BY ID;",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE ID='10';"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 10345, "key": "11", "value": {}},
        {"topic": "test_topic", "timestamp": 10345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 13345, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 7000, 11000, 10345, 1]}},
          {"row":{"columns":["10", 8000, 12000, 10345, 1]}},
          {"row":{"columns":["10", 9000, 13000, 10345, 1]}},
          {"row":{"columns":["10", 10000, 14000, 13345, 2]}},
          {"row":{"columns":["10", 11000, 15000, 13345, 1]}},
          {"row":{"columns":["10", 12000, 16000, 13345, 1]}},
          {"row":{"columns":["10", 13000, 17000, 13345, 1]}}
        ]}
      ]
    },
    {
      "name": "session windowed single key lookup without window bounds",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW SESSION(10 SECOND) GROUP BY ID;",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE ID='10';"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": "11", "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 12366, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 12345, 12366, 12366, 2]}}
        ]}
      ]
    },
    {
      "name": "non-windowed with projection",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, AS_VALUE(ID) AS NEWKEY, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT COUNT, CONCAT(NEWKEY, 'x') AS NEWKEY, COUNT * 2 FROM AGGREGATE WHERE ID='10';"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": "11", "value": {}},
        {"topic": "test_topic", "timestamp": 12346, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`COUNT` BIGINT, `NEWKEY` STRING, `KSQL_COL_0` BIGINT"}},
          {"row":{"columns":[1, "10x", 2]}}
        ]}
      ]
    },
    {
      "name": "windowed with projection",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, AS_VALUE(ID) AS NEWKEY, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT COUNT, CONCAT(NEWKEY, 'x') AS NEWKEY, COUNT * 2 FROM AGGREGATE WHERE ID='10' AND WindowStart=12000;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": "11", "value": {}},
        {"topic": "test_topic", "timestamp": 11345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`COUNT` BIGINT, `NEWKEY` STRING, `KSQL_COL_0` BIGINT"}},
          {"row":{"columns":[1, "10x", 2]}}
        ]}
      ]
    },
    {
      "name": "non-windowed projection WITH ID",
      "statements": [
        "CREATE STREAM INPUT (ID DOUBLE KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT ID, COUNT FROM AGGREGATE WHERE ID=10.5;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": 11.2, "value": {}},
        {"topic": "test_topic", "timestamp": 12346, "key": 10.5, "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` DOUBLE KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10.5, 1]}}
        ]}
      ]
    },
    {
      "name": "windowed with projection with key",
      "statements": [
        "CREATE STREAM INPUT (ID DOUBLE KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT COUNT, ID FROM AGGREGATE WHERE ID=10.5 AND WindowStart=12000;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": 11.5, "value": {}},
        {"topic": "test_topic", "timestamp": 11345, "key": 10.5, "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": 10.5, "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`COUNT` BIGINT, `ID` DOUBLE KEY"}},
          {"row":{"columns":[1, 10.5]}}
        ]}
      ]
    },
    {
      "name": "non-windowed projection with ROWTIME",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT ROWTIME + 10 AS ROWTIME_ADJ, COUNT FROM AGGREGATE WHERE ID='10';"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 99, "key": "11", "value": {"val": 1}},
        {"topic": "test_topic", "timestamp": 100, "key": "10", "value": {"val": 2}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ROWTIME_ADJ` BIGINT, `COUNT` BIGINT"}},
          {"row":{"columns":[110, 1]}}
        ]}
      ]
    },
    {
      "name": "windowed with projection with ROWTIME",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT COUNT, ROWTIME FROM AGGREGATE WHERE ID='10' AND WindowStart=12000;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12346, "key": "11", "value": {"val": 1}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {"val": 2}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`COUNT` BIGINT, `ROWTIME` BIGINT"}},
          {"row":{"columns":[1, 12345]}}
        ]}
      ]
    },
    {
      "name": "non-windowed projection with key and more columns in aggregate",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, VAL INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT, SUM(VAL) AS SUM, MIN(VAL) AS MIN FROM INPUT GROUP BY ID;",
        "SELECT ID, COUNT FROM AGGREGATE WHERE ID='10';"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": "11", "value": {"val": 1}},
        {"topic": "test_topic", "timestamp": 12346, "key": "10", "value": {"val": 2}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 1]}}
        ]}
      ]
    },
    {
      "name": "non-windowed projection with key and more columns in lookup",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT COUNT, ID + '-adj' AS ID_ADJ, COUNT AS COUNT2 FROM AGGREGATE WHERE ID='10';"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": "11", "value": {}},
        {"topic": "test_topic", "timestamp": 11345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`COUNT` BIGINT, `ID_ADJ` STRING, `COUNT2` BIGINT"}},
          {"row":{"columns":[2,"10-adj",2]}}
        ]}
      ]
    },
    {
      "name": "text datetime window bounds",
      "comment": "Note: this test must specify a timezone in the exact lookup so that it works when run from any TZ.",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID='10' AND WindowStart>='2020-02-23T23:45:12.000' AND WindowEnd<'2020-02-23T23:55:12.000';"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 1582501512456, "key": "11", "value": {}},
        {"topic": "test_topic", "timestamp": 1582501512456, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 1582501512456, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
           {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 1582501512000, 1582501513000, 2]}}
        ]}
      ]
    },
    {
      "name": "text datetime + timezone window bounds",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID='10' AND WindowStart='2020-02-23T22:45:12.000-0100';"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 1582501512456, "key": "11", "value": {}},
        {"topic": "test_topic", "timestamp": 1582501512456, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 1582501512000, 1582501513000, 1]}}
        ]}
      ]
    },
    {
      "name": "partial text datetime window bounds",
      "comment": "Note: this test has side enough range on dates to ensure running in different timezones do not cause it to fail",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE '2020-02-22T23:45' <= WindowStart AND WindowStart < '2020-02-24T24' AND ID='10';"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 1582501512456, "key": "11", "value": {}},
        {"topic": "test_topic", "timestamp": 1582401512456, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 1582501512456, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 1582501552456, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 1582501512000, 1582501513000, 1]}},
          {"row":{"columns":["10", 1582501552000, 1582501553000, 1]}}
        ]}
      ]
    },
    {
      "name": "aliased table",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE A WHERE '10'=ID;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 1]}}
        ]}
      ]
    },
    {
      "name": "multiple aggregate columns",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT, SUM(CAST(ID AS INT)) AS SUM FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID='10';"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `COUNT` BIGINT, `SUM` INTEGER"}},
          {"row":{"columns":["10", 1, 10]}}
        ]}
      ]
    },
    {
      "name": "having clause on aggregate",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, X INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, SUM(X) AS SUM FROM INPUT GROUP BY ID HAVING SUM(X) < 10;",
        "SELECT * FROM AGGREGATE WHERE ID='10';",
        "SELECT * FROM AGGREGATE WHERE ID='missing';"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {"X": 9}},
        {"topic": "test_topic", "timestamp": 12346, "key": "missing", "value": {"X": 10}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `SUM` INTEGER"}},
          {"row":{"columns":["10", 9]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `SUM` INTEGER"}}
        ]}
      ]
    },
    {
      "name": "non-windowed with UDAF with different intermediate type",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, VAL INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT, AVG(VAL) AS AVG FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID='10';"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": "11", "value": {"val": 1}},
        {"topic": "test_topic", "timestamp": 12346, "key": "10", "value": {"val": 2}},
        {"topic": "test_topic", "timestamp": 12347, "key": "10", "value": {"val": 4}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `COUNT` BIGINT, `AVG` DOUBLE"}},
          {"row":{"columns":["10", 2, 3.0]}}
        ]}
      ]
    },
    {
      "name": "windowed with UDAF with different intermediate type",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, VAL INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT, AVG(VAL) AS AVG FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID='10' AND WindowStart=11000;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": "11", "value": {"VAL": 1}},
        {"topic": "test_topic", "timestamp": 11345, "key": "10", "value": {"VAL": 6}},
        {"topic": "test_topic", "timestamp": 11346, "key": "10", "value": {"VAL": 4}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT, `AVG` DOUBLE"}},
          {"row":{"columns":["10", 11000, 12000, 2, 5.0]}}
        ]}
      ]
    },
    {
      "name": "fail on unsupported query feature: join",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE A JOIN INPUT I ON A.ID=I.ID WHERE A.ID='10';"
      ],
      "expectedError": {
        "type": "io.confluent.ksql.rest.entity.KsqlStatementErrorMessage",
        "message": "Pull queries don't support JOIN clauses.",
        "status": 400
      }
    },
    {
      "name": "fail on unsupported query feature: window",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WINDOW TUMBLING (SIZE 1 SECOND) WHERE ID='10';"
      ],
      "expectedError": {
        "type": "io.confluent.ksql.rest.entity.KsqlStatementErrorMessage",
        "message": "Pull queries don't support WINDOW clauses.",
        "status": 400
      }
    },
    {
      "name": "fail on unsupported query feature: group by",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID='10' GROUP BY ID;"
      ],
      "expectedError": {
        "type": "io.confluent.ksql.rest.entity.KsqlStatementErrorMessage",
        "message": "Pull queries don't support GROUP BY clauses",
        "status": 400
      }
    },
    {
      "name": "fail on unsupported query feature: where key range string",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE '0'<ID AND ID<'100';"
      ],
      "properties": {
        "ksql.query.pull.table.scan.enabled":  false
      },
      "expectedError": {
        "message": "A comparison condition on the key column cannot be combined with other comparisons such as an IN predicate"
      }
    },
    {
      "name": "fail on unsupported query feature: where key not equals",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID != '100';"
      ],
      "properties": {
        "ksql.query.pull.table.scan.enabled":  false
      },
      "expectedError": {
        "type": "io.confluent.ksql.rest.entity.KsqlStatementErrorMessage",
        "message": "Bound on key columns '[`ID` STRING KEY]' must currently be '='. ",
        "status": 400
      }
    },
    {
      "name": "fail on unsupported query feature: where not on key",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE COUNT = 100;"
      ],
      "properties": {
        "ksql.query.pull.table.scan.enabled":  false
      },
      "expectedError": {
        "type": "io.confluent.ksql.rest.entity.KsqlStatementErrorMessage",
        "message": "WHERE clause missing key column for disjunct: (COUNT = 100)",
        "status": 400
      }
    },
    {
      "name": "fail on unsupported query feature: not materialized aggregate",
      "statements": [
        "CREATE TABLE X (ID STRING PRIMARY KEY, NAME STRING) WITH (kafka_topic='test_topic', value_format='JSON');",
        "SELECT * FROM X WHERE ID = '100';"
      ],
      "expectedError": {
        "type": "io.confluent.ksql.rest.entity.KsqlStatementErrorMessage",
        "message": "The `X` table isn't queryable. To derive a queryable table, you can do 'CREATE TABLE QUERYABLE_X AS SELECT * FROM X'. See https://cnfl.io/queries for more info.",
        "status": 400
      }
    },
    {
      "name": "fail if WINDOWSTART used in non-windowed pull query",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID='10' AND WINDOWSTART=10;"
      ],
      "expectedError": {
        "type": "io.confluent.ksql.rest.entity.KsqlStatementErrorMessage",
        "message": "WHERE column 'WINDOWSTART' cannot be resolved",
        "status": 400
      }
    },
    {
      "name": "fail if WINDOWEND used in non-windowed pull query",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID='10' AND WINDOWEND=10;"
      ],
      "expectedError": {
        "type": "io.confluent.ksql.rest.entity.KsqlStatementErrorMessage",
        "message": "WHERE column 'WINDOWEND' cannot be resolved",
        "status": 400
      }
    },
    {
      "name": "window bounds in projection UDF",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT ID, TIMESTAMPTOSTRING(WINDOWSTART, 'yyyy-MM-dd HH:mm:ss Z', 'UTC') AS WSTART, TIMESTAMPTOSTRING(WINDOWEND, 'yyyy-MM-dd HH:mm:ss Z', 'UTC') AS WEND, COUNT FROM AGGREGATE WHERE ID='10';"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 1580318385000, "key": "10", "value": {"val": 2}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WSTART` STRING, `WEND` STRING, `COUNT` BIGINT"}},
          {"row":{"columns":["10", "2020-01-29 17:19:45 +0000", "2020-01-29 17:19:46 +0000", 1]}}
        ]}
      ]
    },
    {
      "name": "access window bounds in selection",
      "statements": [
        "CREATE STREAM INPUT (ID DOUBLE KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT ID, TIMESTAMPTOSTRING(WINDOWSTART, 'yyyy-MM-dd HH:mm:ss Z', 'UTC') AS WSTART, TIMESTAMPTOSTRING(WINDOWEND, 'yyyy-MM-dd HH:mm:ss Z', 'UTC') AS WEND, ROWTIME, COUNT FROM AGGREGATE WHERE ID=10.5 AND WINDOWSTART=1580223282000;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 1580223282123, "key": 11.5, "value": {"val": 1}},
        {"topic": "test_topic", "timestamp": 1580223282456, "key": 10.5, "value": {"val": 2}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` DOUBLE KEY, `WSTART` STRING, `WEND` STRING, `ROWTIME` BIGINT, `COUNT` BIGINT"}},
          {"row":{"columns":[10.5, "2020-01-28 14:54:42 +0000", "2020-01-28 14:54:43 +0000", 1580223282456, 1]}}
        ]}
      ]
    },
    {
      "name": "system columns in projection",
      "statements": [
        "CREATE STREAM INPUT (ID DOUBLE KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT ROWTIME, ID, WINDOWSTART, WINDOWEND FROM AGGREGATE WHERE ID=10.5 AND WindowStart=12000;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": 11.5, "value": {}},
        {"topic": "test_topic", "timestamp": 11345, "key": 10.5, "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": 10.5, "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ROWTIME` BIGINT, `ID` DOUBLE KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY"}},
          {"row":{"columns":[12345, 10.5, 12000, 13000]}}
        ]}
      ]
    },
    {
      "name": "should handled quoted key and value",
      "statements": [
        "CREATE STREAM INPUT (`Key` STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT `Key`, COUNT(1) AS `Value` FROM INPUT GROUP BY `Key`;",
        "SELECT * FROM AGGREGATE WHERE `Key`='10';"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": "11", "value": {}},
        {"topic": "test_topic", "timestamp": 12365, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`Key` STRING KEY, `Value` BIGINT"}},
          {"row":{"columns":["10", 1]}}
        ]}
      ]
    },
    {
      "name": "fail on null key",
      "statements": [
        "CREATE STREAM INPUT (ID INT KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID=NULL;"
      ],
      "expectedError": {
        "type": "io.confluent.ksql.rest.entity.KsqlStatementErrorMessage",
        "message": "Error in WHERE expression: Comparison with NULL not supported: INTEGER = NULL\nUse 'IS NULL' or 'IS NOT NULL' instead.\nStatement: (ID = null)",
        "status": 400
      }
    },
    {
      "name": "window start lower bound",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID='10' AND 13000 <= WindowStart;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 11345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 13345, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["10",13000,14000,1]}}
        ]}
      ]
    },
    {
      "name": "window end lower bound",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID='10' AND 14000 <= WindowEnd;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 11345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 13345, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["10",13000,14000,1]}}
        ]}
      ]
    },
    {
      "name": "window start upper bound",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID='10' AND WindowStart <= 12000;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 11345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 13345, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["10",11000,12000,1]}},
          {"row":{"columns":["10",12000,13000,1]}}
        ]}
      ]
    },
    {
      "name": "window end upper bound",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID='10' AND WindowEnd <= 13000;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 11345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 13345, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["10",11000,12000,1]}},
          {"row":{"columns":["10",12000,13000,1]}}
        ]}
      ]
    },
    {
      "name": "window range - start-start",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID='10' AND 12000 <= WindowStart AND WindowStart < 13000;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 11345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 13345, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["10",12000,13000,1]}}
        ]}
      ]
    },
    {
      "name": "window range - end-end",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID='10' AND 13000 <= WindowEnd AND WindowEnd < 14000;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 11345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 13345, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["10",12000,13000,1]}}
        ]}
      ]
    },
    {
      "name": "window range - start-end",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID='10' AND 12000 <= WindowStart AND WindowEnd < 14000;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 11345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 13345, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["10",12000,13000,1]}}
        ]}
      ]
    },
    {
      "name": "window range - end-start",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID='10' AND 13000 <= WindowEnd AND WindowStart < 13000;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 11345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 13345, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["10",12000,13000,1]}}
        ]}
      ]
    },
    {
      "name": "window range - double lower bound - start highest",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID='10' AND 13000 <=WindowStart AND 13000 <= WindowEnd;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 11345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 13345, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["10",13000,14000,1]}}
        ]}
      ]
    },
    {
      "name": "window range - double lower bound - end highest",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID='10' AND 12000 <=WindowStart AND 14000 <= WindowEnd;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 11345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 13345, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["10",13000,14000,1]}}
        ]}
      ]
    },
    {
      "name": "window range - double upper bound - start lowest",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID='10' AND WindowStart < 12000 AND WindowEnd < 14000;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 11345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 13345, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["10",11000,12000,1]}}
        ]}
      ]
    },
    {
      "name": "window range - double upper bound - end lowest",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID='10' AND WindowStart <= 12000 AND WindowEnd < 13000;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 11345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 13345, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["10",11000,12000,1]}}
        ]}
      ]
    },
    {
      "name": "unwrapped value",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE WITH (wrap_single_value=false) AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID='10';"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 11345, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["10",1]}}
        ]}
      ]
    },
    {
      "name": "non-windowed single key lookup - non-KAFKA key format",
      "statements": [
        "CREATE STREAM INPUT (ID INT KEY, IGNORED INT) WITH (kafka_topic='test_topic', key_format='JSON', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID=10;",
        "SELECT * FROM AGGREGATE WHERE ID=123369;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": 11, "value": {}},
        {"topic": "test_topic", "timestamp": 12365, "key": 10, "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `COUNT` BIGINT"}}
        ]}
      ]
    },
    {
      "name": "non-windowed IN key lookup - STRING",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID IN ('10', '8');",
        "SELECT * FROM AGGREGATE WHERE ID IN ('missing', 'missing again');"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": "11", "value": {}},
        {"topic": "test_topic", "timestamp": 12365, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 12366, "key": "9", "value": {}},
        {"topic": "test_topic", "timestamp": 12367, "key": "8", "value": {}},
        {"topic": "test_topic", "timestamp": 12368, "key": "12", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 1]}},
          {"row":{"columns":["8", 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `COUNT` BIGINT"}}
        ]}
      ]
    },
    {
      "name": "non-windowed IN key lookup - INT",
      "statements": [
        "CREATE STREAM INPUT (ID INT KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID IN (10, 8);",
        "SELECT * FROM AGGREGATE WHERE ID IN (123369, 123370);"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": 11, "value": {}},
        {"topic": "test_topic", "timestamp": 12365, "key": 10, "value": {}},
        {"topic": "test_topic", "timestamp": 12366, "key": 9, "value": {}},
        {"topic": "test_topic", "timestamp": 12367, "key": 8, "value": {}},
        {"topic": "test_topic", "timestamp": 12368, "key": 12, "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10, 1]}},
          {"row":{"columns":[8, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `COUNT` BIGINT"}}
        ]}
      ]
    },
    {
      "name": "non-windowed IN key lookup - BIGINT",
      "statements": [
        "CREATE STREAM INPUT (ID BIGINT KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID IN (10, 8);",
        "SELECT * FROM AGGREGATE WHERE ID IN (123369, 123370);"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": 11, "value": {}},
        {"topic": "test_topic", "timestamp": 12365, "key": 10, "value": {}},
        {"topic": "test_topic", "timestamp": 12366, "key": 9, "value": {}},
        {"topic": "test_topic", "timestamp": 12367, "key": 8, "value": {}},
        {"topic": "test_topic", "timestamp": 12368, "key": 12, "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10, 1]}},
          {"row":{"columns":[8, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` BIGINT KEY, `COUNT` BIGINT"}}
        ]}
      ]
    },
    {
      "name": "non-windowed IN key lookup - DOUBLE",
      "statements": [
        "CREATE STREAM INPUT (ID DOUBLE KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID IN (10, 8.0);",
        "SELECT * FROM AGGREGATE WHERE ID IN (1.0E1, 8);",
        "SELECT * FROM AGGREGATE WHERE ID IN (123369, 123370);"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": 11.0, "value": {}},
        {"topic": "test_topic", "timestamp": 12365, "key": 10.0, "value": {}},
        {"topic": "test_topic", "timestamp": 12366, "key": 9.0, "value": {}},
        {"topic": "test_topic", "timestamp": 12367, "key": 8.0, "value": {}},
        {"topic": "test_topic", "timestamp": 12368, "key": 12.0, "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` DOUBLE KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10.0, 1]}},
          {"row":{"columns":[8.0, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` DOUBLE KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10.0, 1]}},
          {"row":{"columns":[8.0, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` DOUBLE KEY, `COUNT` BIGINT"}}
        ]}
      ]
    },
    {
      "name": "non-windowed IN lookup on wrong type",
      "statements": [
        "CREATE STREAM INPUT (ID INT KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID IN ('10', 8);"
      ],
      "expectedError": {
        "type": "io.confluent.ksql.rest.entity.KsqlStatementErrorMessage",
        "message": "'10' can not be converted to the type of the key column: ID INTEGER KEY",
        "status": 400
      }
    },
    {
      "name": "windowed - IN: select star",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID IN ('10', '8');"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": "11", "value": {"val": 1}},
        {"topic": "test_topic", "timestamp": 12365, "key": "10", "value": {"val": 2}},
        {"topic": "test_topic", "timestamp": 12366, "key": "9", "value": {"val": 3}},
        {"topic": "test_topic", "timestamp": 12367, "key": "8", "value": {"val": 4}},
        {"topic": "test_topic", "timestamp": 12368, "key": "12", "value": {"val": 5}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 12000, 13000, 1]}},
          {"row":{"columns":["8", 12000, 13000, 1]}}
        ]}
      ]
    },
    {
      "name": "windowed - IN: select star and ROWTIME",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT ID, WINDOWSTART, WINDOWEND, COUNT, ROWTIME FROM AGGREGATE WHERE ID IN ('10', '8');",
        "SELECT ID, WINDOWSTART, WINDOWEND, COUNT, ROWTIME FROM AGGREGATE WHERE ID IN ('missing', 'missing again');"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12346, "key": "11", "value": {"val": 1}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {"val": 2}},
        {"topic": "test_topic", "timestamp": 12366, "key": "9", "value": {"val": 3}},
        {"topic": "test_topic", "timestamp": 12367, "key": "8", "value": {"val": 4}},
        {"topic": "test_topic", "timestamp": 12368, "key": "12", "value": {"val": 5}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT, `ROWTIME` BIGINT"}},
          {"row":{"columns":["10", 12000, 13000, 1, 12345]}},
          {"row":{"columns":["8", 12000, 13000, 1, 12367]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT, `ROWTIME` BIGINT"}}
        ]}
      ]
    },
    {
      "name": "windowed IN key lookup - STRING",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID IN ('10', '8');",
        "SELECT * FROM AGGREGATE WHERE ID IN ('missing', 'missing again');"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12346, "key": "11", "value": {"val": 1}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {"val": 2}},
        {"topic": "test_topic", "timestamp": 12366, "key": "9", "value": {"val": 3}},
        {"topic": "test_topic", "timestamp": 12367, "key": "8", "value": {"val": 4}},
        {"topic": "test_topic", "timestamp": 12368, "key": "12", "value": {"val": 5}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 12000, 13000, 1]}},
          {"row":{"columns":["8", 12000, 13000, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}}
        ]}
      ]
    },
    {
      "name": "windowed IN key lookup - INT",
      "statements": [
        "CREATE STREAM INPUT (ID INT KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID IN (10, 8);",
        "SELECT * FROM AGGREGATE WHERE ID IN (0, 1);"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12346, "key": 11, "value": {"val": 1}},
        {"topic": "test_topic", "timestamp": 12345, "key": 10, "value": {"val": 2}},
        {"topic": "test_topic", "timestamp": 12366, "key": 9, "value": {"val": 3}},
        {"topic": "test_topic", "timestamp": 12367, "key": 8, "value": {"val": 4}},
        {"topic": "test_topic", "timestamp": 12368, "key": 12, "value": {"val": 5}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10, 12000, 13000, 1]}},
          {"row":{"columns":[8, 12000, 13000, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}}
        ]}
      ]
    },
    {
      "name": "windowed IN key lookup - BIGINT",
      "statements": [
        "CREATE STREAM INPUT (ID BIGINT KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID IN (10, 8);",
        "SELECT * FROM AGGREGATE WHERE ID IN (0, 1);"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12346, "key": 11, "value": {"val": 1}},
        {"topic": "test_topic", "timestamp": 12345, "key": 10, "value": {"val": 2}},
        {"topic": "test_topic", "timestamp": 12366, "key": 9, "value": {"val": 3}},
        {"topic": "test_topic", "timestamp": 12367, "key": 8, "value": {"val": 4}},
        {"topic": "test_topic", "timestamp": 12368, "key": 12, "value": {"val": 5}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` BIGINT KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10, 12000, 13000, 1]}},
          {"row":{"columns":[8, 12000, 13000, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` BIGINT KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}}
        ]}
      ]
    },
    {
      "name": "windowed IN key lookup - DOUBLE",
      "statements": [
        "CREATE STREAM INPUT (ID DOUBLE KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID IN (10.5, 8.5);",
        "SELECT * FROM AGGREGATE WHERE ID IN (0, 1.0);"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12346, "key": 11.5, "value": {"val": 1}},
        {"topic": "test_topic", "timestamp": 12345, "key": 10.5, "value": {"val": 2}},
        {"topic": "test_topic", "timestamp": 12366, "key": 9.5, "value": {"val": 3}},
        {"topic": "test_topic", "timestamp": 12367, "key": 8.5, "value": {"val": 4}},
        {"topic": "test_topic", "timestamp": 12368, "key": 12.5, "value": {"val": 5}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` DOUBLE KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10.5, 12000, 13000, 1]}},
          {"row":{"columns":[8.5, 12000, 13000, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` DOUBLE KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}}
        ]}
      ]
    },
    {
      "name": "windowed IN lookup on wrong type",
      "statements": [
        "CREATE STREAM INPUT (ID INT KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID IN ('10', 8);"
      ],
      "expectedError": {
        "type": "io.confluent.ksql.rest.entity.KsqlStatementErrorMessage",
        "message": "'10' can not be converted to the type of the key column: ID INTEGER KEY",
        "status": 400
      }
    },
    {
      "name": "tumbling windowed IN key lookup with window start-end range",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE 100 <= WindowStart AND WindowEnd < 200000 AND ID IN ('10', '8');",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE 12000 <= WindowStart AND WindowEnd < 14000 AND ID IN ('10', '8');",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE 12000 < WindowStart AND WindowEnd <= 15000 AND ID IN ('10', '8');",
        "SELECT ID, WINDOWSTART, WINDOWEND, ROWTIME, COUNT FROM AGGREGATE WHERE WindowStart > 17000 AND 11234756356 > WindowEnd AND ID IN ('10', '8');"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12001, "key": "11", "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 12211, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 14253, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 15364, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 12346, "key": "8", "value": {}},
        {"topic": "test_topic", "timestamp": 12212, "key": "8", "value": {}},
        {"topic": "test_topic", "timestamp": 15365, "key": "8", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 12000, 13000, 12345, 2]}},
          {"row":{"columns":["10", 14000, 15000, 14253, 1]}},
          {"row":{"columns":["10", 15000, 16000, 15364, 1]}},
          {"row":{"columns":["8", 12000, 13000, 12346, 2]}},
          {"row":{"columns":["8", 15000, 16000, 15365, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 12000, 13000, 12345, 2]}},
          {"row":{"columns":["8", 12000, 13000, 12346, 2]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 14000, 15000, 14253, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `ROWTIME` BIGINT, `COUNT` BIGINT"}}
        ]}
      ]
    },
    {
      "name": "IN: should handled quoted key and value",
      "statements": [
        "CREATE STREAM INPUT (`Key` STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT `Key`, COUNT(1) AS `Value` FROM INPUT GROUP BY `Key`;",
        "SELECT * FROM AGGREGATE WHERE `Key` IN ('10');"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": "11", "value": {}},
        {"topic": "test_topic", "timestamp": 12365, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`Key` STRING KEY, `Value` BIGINT"}},
          {"row":{"columns":["10", 1]}}
        ]}
      ]
    },
    {
      "name": "IN: fail on null key",
      "statements": [
        "CREATE STREAM INPUT (ID INT KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID IN (NULL);"
      ],
      "expectedError": {
        "type": "io.confluent.ksql.rest.entity.KsqlStatementErrorMessage",
        "message": "Primary key columns can not be NULL: (ID = null)",
        "status": 400
      }
    },
    {
      "name": "IN: fail on column reference key",
      "statements": [
        "CREATE STREAM INPUT (ID INT KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID IN (2, COUNT + 1, 3);"
      ],
      "properties": {
        "ksql.query.pull.table.scan.enabled":  false
      },
      "expectedError": {
        "type": "io.confluent.ksql.rest.entity.KsqlStatementErrorMessage",
        "message": "A comparison must be between a key column and a resolvable expression.",
        "status": 400
      }
    },
    {
      "name": "non-windowed - function in where clause",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT ID, COUNT, ROWTIME FROM AGGREGATE WHERE ID=CONCAT('1','0');"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": "11", "value": {}},
        {"topic": "test_topic", "timestamp": 12365, "key": "10", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `COUNT` BIGINT, `ROWTIME` BIGINT"}},
          {"row":{"columns":["10", 1, 12365]}}
        ]}
      ]
    },
    {
      "name": "non-windowed - array keys",
      "statements": [
        "CREATE STREAM INPUT (ID ARRAY<STRING> KEY, IGNORED INT) WITH (kafka_topic='test_topic', format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT ID, COUNT, ROWTIME FROM AGGREGATE WHERE ID=ARRAY['1','0'];"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": ["1", "1"], "value": {}},
        {"topic": "test_topic", "timestamp": 12365, "key": ["1", "0"], "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` ARRAY<STRING> KEY, `COUNT` BIGINT, `ROWTIME` BIGINT"}},
          {"row":{"columns":[["1", "0"], 1, 12365]}}
        ]}
      ]
    },
    {
      "name": "non-windowed - struct keys",
      "statements": [
        "CREATE STREAM INPUT (ID STRUCT<f1 STRING, f2 STRING> KEY, IGNORED INT) WITH (kafka_topic='test_topic', format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT ID, COUNT, ROWTIME FROM AGGREGATE WHERE ID=STRUCT(F1:='1',F2:='0');"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": {"F1": "1", "F2": "1"}, "value": {}},
        {"topic": "test_topic", "timestamp": 12365, "key": {"F1": "1", "F2": "0"}, "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRUCT<`F1` STRING, `F2` STRING> KEY, `COUNT` BIGINT, `ROWTIME` BIGINT"}},
          {"row":{"columns":[{"F1": "1", "F2": "0"}, 1, 12365]}}
        ]}
      ]
    },
    {
      "name": "IN: support non-literal key",
      "statements": [
        "CREATE STREAM INPUT (ID INT KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID IN (CAST(10 AS INTEGER));"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": 11, "value": {}},
        {"topic": "test_topic", "timestamp": 12365, "key": 10, "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10, 1]}}
        ]}
      ]
    },
    {
      "name": "non-windowed - Table Scan - select star and ROWTIME",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT ID, COUNT, ROWTIME FROM AGGREGATE;",
        "SELECT * FROM AGGREGATE;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12365, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": "11", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `COUNT` BIGINT, `ROWTIME` BIGINT"}},
          {"row":{"columns":["11", 1, 12345]}},
          {"row":{"columns":["10", 1, 12365]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["11", 1]}},
          {"row":{"columns":["10", 1]}}
        ]}
      ]
    },
    {
      "name": "windowed - Table Scan - select star and ROWTIME",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT ID, WINDOWSTART, WINDOWEND, COUNT, ROWTIME FROM AGGREGATE;",
        "SELECT * FROM AGGREGATE;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {"val": 1}},
        {"topic": "test_topic", "timestamp": 12346, "key": "11", "value": {"val": 2}},
        {"topic": "test_topic", "timestamp": 13346, "key": "11", "value": {"val": 3}},
        {"topic": "test_topic", "timestamp": 13345, "key": "10", "value": {"val": 4}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT, `ROWTIME` BIGINT"}},
          {"row":{"columns":["11", 12000, 13000, 1, 12346]}},
          {"row":{"columns":["11", 13000, 14000, 1, 13346]}},
          {"row":{"columns":["10", 12000, 13000, 1, 12345]}},
          {"row":{"columns":["10", 13000, 14000, 1, 13345]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["11", 12000, 13000, 1]}},
          {"row":{"columns":["11", 13000, 14000, 1]}},
          {"row":{"columns":["10", 12000, 13000, 1]}},
          {"row":{"columns":["10", 13000, 14000, 1]}}
        ]}
      ]
    },
    {
      "name": "windowed - Table Scan - missing key, windowed system columns only",
      "statements": [
        "CREATE STREAM INPUT (ID INTEGER KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE WINDOWSTART > 12500;",
        "SELECT * FROM AGGREGATE WHERE WINDOWEND < 13500;",
        "SELECT * FROM AGGREGATE WHERE WINDOWSTART > 12500 AND WINDOWEND < 13500;",
        "SELECT * FROM AGGREGATE WHERE WINDOWSTART > 11500 AND WINDOWEND < 13500;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": 10, "value": {"val": 1}},
        {"topic": "test_topic", "timestamp": 12346, "key": 11, "value": {"val": 2}},
        {"topic": "test_topic", "timestamp": 13346, "key": 11, "value": {"val": 3}},
        {"topic": "test_topic", "timestamp": 13345, "key": 10, "value": {"val": 4}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10, 13000, 14000, 1]}},
          {"row":{"columns":[11, 13000, 14000, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10, 12000, 13000, 1]}},
          {"row":{"columns":[11, 12000, 13000, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10, 12000, 13000, 1]}},
          {"row":{"columns":[11, 12000, 13000, 1]}}
        ]}
      ]
    },
    {
      "name": "non-windowed - Table Scan - indirect column reference",
      "statements": [
        "CREATE STREAM INPUT (ID INTEGER KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID + 10 = 20;",
        "SELECT * FROM AGGREGATE WHERE 2 * COUNT > 5;",
        "SELECT id, floor(exp(ID)) as val  FROM AGGREGATE WHERE floor(exp(ID)) > 30000;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12365, "key": 10, "value": {}},
        {"topic": "test_topic", "timestamp": 12375, "key": 10, "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": 11, "value": {}},
        {"topic": "test_topic", "timestamp": 12355, "key": 11, "value": {}},
        {"topic": "test_topic", "timestamp": 12365, "key": 11, "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10, 2]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[11, 3]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `VAL` DOUBLE"}},
          {"row":{"columns":[11, 59874.0]}}
        ]}
      ]
    },
    {
      "name": "windowed - Table Scan - indirect column reference",
      "statements": [
        "CREATE STREAM INPUT (ID INTEGER KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID + 10 = 20;",
        "SELECT * FROM AGGREGATE WHERE ID + 10 = 20 and WINDOWSTART > 12500;",
        "SELECT id, WINDOWSTART, WINDOWEND, COUNT, FLOOR(SQRT(WINDOWSTART)) as val FROM AGGREGATE WHERE SQRT(WINDOWSTART) > 110.0;",
        "SELECT id, WINDOWSTART, WINDOWEND, COUNT, floor(exp(ID)) as val  FROM AGGREGATE WHERE floor(exp(ID)) > 30000;",
        "SELECT id, WINDOWSTART, WINDOWEND, COUNT, floor(exp(ID)) as val  FROM AGGREGATE WHERE floor(exp(ID)) > 30000 AND WINDOWEND < 13500;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": 10, "value": {"val": 1}},
        {"topic": "test_topic", "timestamp": 12346, "key": 11, "value": {"val": 2}},
        {"topic": "test_topic", "timestamp": 13346, "key": 11, "value": {"val": 3}},
        {"topic": "test_topic", "timestamp": 13345, "key": 10, "value": {"val": 4}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10, 12000, 13000, 1]}},
          {"row":{"columns":[10, 13000, 14000, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10, 13000, 14000, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT, `VAL` DOUBLE"}},
          {"row":{"columns":[10, 13000, 14000, 1, 114.0]}},
          {"row":{"columns":[11, 13000, 14000, 1, 114.0]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT, `VAL` DOUBLE"}},
          {"row":{"columns":[11, 12000, 13000, 1, 59874.0]}},
          {"row":{"columns":[11, 13000, 14000, 1, 59874.0]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT, `VAL` DOUBLE"}},
          {"row":{"columns":[11, 12000, 13000, 1, 59874.0]}}
        ]}
      ]
    },
    {
      "name": "windowed - Resolving keys for key lookups",
      "statements": [
        "CREATE STREAM INPUT (ID INTEGER KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID = 10 AND WINDOWSTART > 12500 + 10;",
        "SELECT * FROM AGGREGATE WHERE ID = 10 + 1 AND WINDOWSTART > 12500 + 10;",
        "SELECT * FROM AGGREGATE WHERE ID = 10 + 1 AND WINDOWEND < 13500 + 10;",
        "SELECT * FROM AGGREGATE WHERE ID = 11 - 1 AND WINDOWSTART > 11000 + 50 AND WINDOWEND < 13500 + 10;"
      ],
      "properties": {
        "ksql.query.pull.table.scan.enabled":  false
      },
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": 10, "value": {"val": 1}},
        {"topic": "test_topic", "timestamp": 12346, "key": 11, "value": {"val": 2}},
        {"topic": "test_topic", "timestamp": 13346, "key": 11, "value": {"val": 3}},
        {"topic": "test_topic", "timestamp": 13345, "key": 10, "value": {"val": 4}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10, 13000, 14000, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[11, 13000, 14000, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[11, 12000, 13000, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10, 12000, 13000, 1]}}
        ]}
      ]
    },
    {
      "name": "non-windowed - Table Scan - non column ref is unresolvable or there is no column ref",
      "statements": [
        "CREATE STREAM INPUT (ID INTEGER KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID = 20 - 10;",
        "SELECT * FROM AGGREGATE WHERE ID < COUNT;",
        "SELECT * FROM AGGREGATE WHERE ID = COUNT;",
        "SELECT * FROM AGGREGATE WHERE ID + 1 = COUNT;",
        "SELECT * FROM AGGREGATE WHERE ID + 1 = COUNT + 1;",
        "SELECT * FROM AGGREGATE WHERE 2 < 5;",
        "SELECT * FROM AGGREGATE WHERE 2 > 5;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12365, "key": 2, "value": {}},
        {"topic": "test_topic", "timestamp": 12365, "key": 2, "value": {}},
        {"topic": "test_topic", "timestamp": 12365, "key": 2, "value": {}},
        {"topic": "test_topic", "timestamp": 12365, "key": 3, "value": {}},
        {"topic": "test_topic", "timestamp": 12365, "key": 3, "value": {}},
        {"topic": "test_topic", "timestamp": 12365, "key": 3, "value": {}},
        {"topic": "test_topic", "timestamp": 12365, "key": 10, "value": {}},
        {"topic": "test_topic", "timestamp": 12375, "key": 10, "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": 11, "value": {}},
        {"topic": "test_topic", "timestamp": 12355, "key": 11, "value": {}},
        {"topic": "test_topic", "timestamp": 12365, "key": 11, "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10, 2]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[2, 3]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[3, 3]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[2, 3]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[3, 3]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10, 2]}},
          {"row":{"columns":[2, 3]}},
          {"row":{"columns":[3, 3]}},
          {"row":{"columns":[11, 3]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `COUNT` BIGINT"}}
        ]}
      ]
    },
    {
      "name": "fail on unsupported query feature: No column key",
      "statements": [
        "CREATE STREAM INPUT (ID INTEGER KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID + 10 = 20;"
      ],
      "properties": {
        "ksql.query.pull.table.scan.enabled":  false
      },
      "expectedError": {
        "type": "io.confluent.ksql.rest.entity.KsqlStatementErrorMessage",
        "message": "A comparison must directly reference a key column.",
        "status": 400
      }
    },
    {
      "name": "fail on unsupported query feature: Two columns in comparison",
      "statements": [
        "CREATE STREAM INPUT (ID INTEGER KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID = COUNT;"
      ],
      "properties": {
        "ksql.query.pull.table.scan.enabled":  false
      },
      "expectedError": {
        "type": "io.confluent.ksql.rest.entity.KsqlStatementErrorMessage",
        "message": "A comparison must be between a key column and a resolvable expression.",
        "status": 400
      }
    },
    {
      "name": "fail on unsupported query feature: Non column key is unresolvable",
      "statements": [
        "CREATE STREAM INPUT (ID INTEGER KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID = COUNT - 1;"
      ],
      "properties": {
        "ksql.query.pull.table.scan.enabled":  false
      },
      "expectedError": {
        "type": "io.confluent.ksql.rest.entity.KsqlStatementErrorMessage",
        "message": "A comparison must be between a key column and a resolvable expression.",
        "status": 400
      }
    },
    {
      "name": "multi-column aggregation",
      "statements": [
        "CREATE STREAM INPUT (ID1 STRING KEY, ID2 INT) WITH (kafka_topic='test_topic', format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID1, ID2, COUNT(1) AS COUNT FROM INPUT GROUP BY ID1, ID2;",
        "SELECT * FROM AGGREGATE WHERE ID1='11' AND ID2=10;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": "11", "value": {"id2": 10}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID1` STRING KEY, `ID2` INTEGER KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["11", 10, 1]}}
        ]}
      ]
    },
    {
      "name": "multi-column windowed aggregation",
      "statements": [
        "CREATE STREAM INPUT (ID1 STRING KEY, ID2 INT) WITH (kafka_topic='test_topic', format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID1, ID2, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID1, ID2;",
        "SELECT * FROM AGGREGATE WHERE ID1='11' AND ID2=10 AND WindowStart <= 13000 AND WindowEnd < 17000;",
        "SELECT * FROM AGGREGATE WHERE ID1='11' AND ID2=10 AND WindowStart >= 13000 AND WindowEnd < 17000;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12000, "key": "11", "value": {"id2": 10}},
        {"topic": "test_topic", "timestamp": 12000, "key": "11", "value": {"id2": 10}},
        {"topic": "test_topic", "timestamp": 14000, "key": "11", "value": {"id2": 10}},
        {"topic": "test_topic", "timestamp": 14000, "key": "11", "value": {"id2": 10}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID1` STRING KEY, `ID2` INTEGER KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["11", 10, 12000, 13000, 2]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID1` STRING KEY, `ID2` INTEGER KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["11", 10, 14000, 15000, 2]}}
        ]}
      ]
    },
    {
      "name": "non-windowed General WHERE - OR lookup",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID = '10' OR ID = '8';"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": "11", "value": {}},
        {"topic": "test_topic", "timestamp": 12365, "key": "10", "value": {}},
        {"topic": "test_topic", "timestamp": 12366, "key": "9", "value": {}},
        {"topic": "test_topic", "timestamp": 12367, "key": "8", "value": {}},
        {"topic": "test_topic", "timestamp": 12368, "key": "12", "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 1]}},
          {"row":{"columns":["8", 1]}}
        ]}
      ]
    },
    {
      "name": "windowed General WHERE - window range",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE WINDOWSTART >= 12000 AND (ID = '10' OR ID = '8' OR ID = '12');",
        "SELECT * FROM AGGREGATE WHERE WINDOWSTART >= 12000 AND WINDOWEND <= 13000 AND (ID = '10' OR ID = '8' OR ID = '12');",
        "SELECT * FROM AGGREGATE WHERE WINDOWSTART >= 12000 AND ID = '10' OR ID = '8' OR WINDOWEND <= 13000 AND ID = '12';",
        "SELECT * FROM AGGREGATE WHERE WINDOWSTART >= 12000 AND WINDOWEND <= 13000 AND ID = '8' OR WINDOWSTART >= 14000 AND WINDOWEND <= 15000 AND ID = '8';"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12346, "key": "11", "value": {"val": 1}},
        {"topic": "test_topic", "timestamp": 11345, "key": "10", "value": {"val": 2}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {"val": 2}},
        {"topic": "test_topic", "timestamp": 12366, "key": "9", "value": {"val": 3}},
        {"topic": "test_topic", "timestamp": 12367, "key": "8", "value": {"val": 4}},
        {"topic": "test_topic", "timestamp": 14367, "key": "8", "value": {"val": 4}},
        {"topic": "test_topic", "timestamp": 15367, "key": "8", "value": {"val": 4}},
        {"topic": "test_topic", "timestamp": 12368, "key": "12", "value": {"val": 5}},
        {"topic": "test_topic", "timestamp": 13368, "key": "12", "value": {"val": 5}},
        {"topic": "test_topic", "timestamp": 16369, "key": "13", "value": {"val": 6}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 12000, 13000, 1]}},
          {"row":{"columns":["12", 12000, 13000, 1]}},
          {"row":{"columns":["12", 13000, 14000, 1]}},
          {"row":{"columns":["8", 12000, 13000, 1]}},
          {"row":{"columns":["8", 14000, 15000, 1]}},
          {"row":{"columns":["8", 15000, 16000, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 12000, 13000, 1]}},
          {"row":{"columns":["12", 12000, 13000, 1]}},
          {"row":{"columns":["8", 12000, 13000, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["10", 12000, 13000, 1]}},
          {"row":{"columns":["12", 12000, 13000, 1]}},
          {"row":{"columns":["8", 12000, 13000, 1]}},
          {"row":{"columns":["8", 14000, 15000, 1]}},
          {"row":{"columns":["8", 15000, 16000, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["8", 12000, 13000, 1]}},
          {"row":{"columns":["8", 14000, 15000, 1]}}
        ]}
      ]
    },
    {
      "name": "fail on unsupported query feature: where key range",
      "statements": [
        "CREATE STREAM INPUT (ID INTEGER KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE 0 < ID AND ID < 100;"
      ],
      "properties": {
        "ksql.query.pull.table.scan.enabled":  false
      },
      "expectedError": {
        "message": "A comparison condition on the key column cannot be combined with other comparisons such as an IN predicate"
      }
    },
    {
      "name": "Generalized WHERE: key range",
      "statements": [
        "CREATE STREAM INPUT (ID INTEGER KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE 10 < ID AND ID < 100;"
      ],
      "properties": {
        "ksql.query.pull.table.scan.enabled":  true
      },
      "inputs": [
        {"topic": "test_topic", "timestamp": 1582501512456, "key": -1, "value": {}},
        {"topic": "test_topic", "timestamp": 1582501512456, "key": 10, "value": {}},
        {"topic": "test_topic", "timestamp": 1582401512456, "key": 11, "value": {}},
        {"topic": "test_topic", "timestamp": 1582501512456, "key": 50, "value": {}},
        {"topic": "test_topic", "timestamp": 1582501552456, "key": 101, "value": {}},
        {"topic": "test_topic", "timestamp": 1582501512456, "key": 75, "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[75, 1]}},
          {"row":{"columns":[50, 1]}},
          {"row":{"columns":[11, 1]}}
        ]}
      ]
    },
    {
      "name": "Generalized WHERE: key range - windowed",
      "statements": [
        "CREATE STREAM INPUT (ID INTEGER KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE 10 < ID AND ID < 100;",
        "SELECT * FROM AGGREGATE WHERE 10 < ID AND ID < 100 AND WINDOWEND < 14000;",
        "SELECT * FROM AGGREGATE WHERE 10 < ID AND ID < 100 AND WINDOWSTART > 12000;",
        "SELECT * FROM AGGREGATE WHERE 10 < ID AND ID < 100 AND WINDOWSTART > 12000 AND WINDOWEND < 15000;"
      ],
      "properties": {
        "ksql.query.pull.table.scan.enabled":  true
      },
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": -1, "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": 10, "value": {}},
        {"topic": "test_topic", "timestamp": 12445, "key": 10, "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": 11, "value": {}},
        {"topic": "test_topic", "timestamp": 12445, "key": 11, "value": {}},
        {"topic": "test_topic", "timestamp": 13445, "key": 11, "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": 50, "value": {}},
        {"topic": "test_topic", "timestamp": 13345, "key": 50, "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": 101, "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": 75, "value": {}},
        {"topic": "test_topic", "timestamp": 14345, "key": 75, "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[75, 12000, 13000, 1]}},
          {"row":{"columns":[75, 14000, 15000, 1]}},
          {"row":{"columns":[50, 12000, 13000, 1]}},
          {"row":{"columns":[50, 13000, 14000, 1]}},
          {"row":{"columns":[11, 12000, 13000, 2]}},
          {"row":{"columns":[11, 13000, 14000, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[75, 12000, 13000, 1]}},
          {"row":{"columns":[50, 12000, 13000, 1]}},
          {"row":{"columns":[11, 12000, 13000, 2]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[75, 14000, 15000, 1]}},
          {"row":{"columns":[50, 13000, 14000, 1]}},
          {"row":{"columns":[11, 13000, 14000, 1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[50, 13000, 14000, 1]}},
          {"row":{"columns":[11, 13000, 14000, 1]}}
        ]}
      ]
    },
    {
      "name": "fail on unsupported query feature: where key multiple times",
      "statements": [
        "CREATE STREAM INPUT (ID INTEGER KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID = 10 AND ID IN (1, 2, 3, 10);"
      ],
      "properties": {
        "ksql.query.pull.table.scan.enabled":  false
      },
      "expectedError": {
        "message": "A comparison condition on the key column cannot be combined with other comparisons such as an IN predicate"
      }
    },
    {
      "name": "Generalized WHERE: multiple same key references ",
      "statements": [
        "CREATE STREAM INPUT (ID INTEGER KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID = 10 AND ID IN (1, 2, 3, 10);"
      ],
      "properties": {
        "ksql.query.pull.table.scan.enabled":  true
      },
      "inputs": [
        {"topic": "test_topic", "timestamp": 1582501512456, "key": -1, "value": {}},
        {"topic": "test_topic", "timestamp": 1582501512456, "key": 10, "value": {}},
        {"topic": "test_topic", "timestamp": 1582401512456, "key": 11, "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10, 1]}}
        ]}
      ]
    },
    {
      "name": "Generalized WHERE: multiple same key references - windowed",
      "statements": [
        "CREATE STREAM INPUT (ID INTEGER KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE (ID = 10 OR ID = 50) AND ID IN (50, 1, 2, 3, 10);"
      ],
      "properties": {
        "ksql.query.pull.table.scan.enabled":  true
      },
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": -1, "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": 10, "value": {}},
        {"topic": "test_topic", "timestamp": 12445, "key": 10, "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": 11, "value": {}},
        {"topic": "test_topic", "timestamp": 12445, "key": 11, "value": {}},
        {"topic": "test_topic", "timestamp": 13445, "key": 11, "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": 50, "value": {}},
        {"topic": "test_topic", "timestamp": 13345, "key": 50, "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": 101, "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": 75, "value": {}},
        {"topic": "test_topic", "timestamp": 14345, "key": 75, "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10, 12000, 13000, 2]}},
          {"row":{"columns":[50, 12000, 13000, 1]}},
          {"row":{"columns":[50, 13000, 14000, 1]}}
        ]}
      ]
    },
    {
      "name": "fail on unsupported query feature: where range on non key",
      "statements": [
        "CREATE STREAM INPUT (ID INTEGER KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE COUNT > 1;"
      ],
      "properties": {
        "ksql.query.pull.table.scan.enabled":  false
      },
      "expectedError": {
        "type": "io.confluent.ksql.rest.entity.KsqlStatementErrorMessage",
        "message": "WHERE clause missing key column for disjunct: (COUNT > 1)",
        "status": 400
      }
    },
    {
      "name": "Generalized WHERE: non key range",
      "statements": [
        "CREATE STREAM INPUT (ID INTEGER KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE COUNT > 1;"
      ],
      "properties": {
        "ksql.query.pull.table.scan.enabled":  true
      },
      "inputs": [
        {"topic": "test_topic", "timestamp": 1582501512451, "key": -1, "value": {}},
        {"topic": "test_topic", "timestamp": 1582501512452, "key": 10, "value": {}},
        {"topic": "test_topic", "timestamp": 1582401512453, "key": 11, "value": {}},
        {"topic": "test_topic", "timestamp": 1582401512454, "key": 11, "value": {}},
        {"topic": "test_topic", "timestamp": 1582501512455, "key": 50, "value": {}},
        {"topic": "test_topic", "timestamp": 1582501552456, "key": 101, "value": {}},
        {"topic": "test_topic", "timestamp": 1582501552457, "key": 101, "value": {}},
        {"topic": "test_topic", "timestamp": 1582501552458, "key": 101, "value": {}},
        {"topic": "test_topic", "timestamp": 1582501512459, "key": 75, "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[101, 3]}},
          {"row":{"columns":[11, 2]}}
        ]}
      ]
    },
    {
      "name": "Generalized WHERE: non key range - windowed",
      "statements": [
        "CREATE STREAM INPUT (ID INTEGER KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE COUNT > 1;"
      ],
      "properties": {
        "ksql.query.pull.table.scan.enabled":  true
      },
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": -1, "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": 10, "value": {}},
        {"topic": "test_topic", "timestamp": 12445, "key": 10, "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": 11, "value": {}},
        {"topic": "test_topic", "timestamp": 12445, "key": 11, "value": {}},
        {"topic": "test_topic", "timestamp": 13445, "key": 11, "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": 50, "value": {}},
        {"topic": "test_topic", "timestamp": 13345, "key": 50, "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": 101, "value": {}},
        {"topic": "test_topic", "timestamp": 12345, "key": 75, "value": {}},
        {"topic": "test_topic", "timestamp": 14345, "key": 75, "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10, 12000, 13000, 2]}},
          {"row":{"columns":[11, 12000, 13000, 2]}}
        ]}
      ]
    },
    {
      "name": "fail on unsupported query feature: where missing key column",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE WINDOWSTART >= 12000;"
      ],
      "properties": {
        "ksql.query.pull.table.scan.enabled":  false
      },
      "expectedError": {
        "type": "io.confluent.ksql.rest.entity.KsqlStatementErrorMessage",
        "message": "WHERE clause missing key column for disjunct",
        "status": 400
      }
    },
    {
      "name": "Generalized WHERE: non key special column reference - windowed",
      "statements": [
        "CREATE STREAM INPUT (ID STRING KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE WINDOWSTART >= 13000;",
        "SELECT * FROM AGGREGATE WHERE WINDOWSTART >= 13000 AND WINDOWEND <= 15000;"
      ],
      "properties": {
        "ksql.query.pull.table.scan.enabled":  true
      },
      "inputs": [
        {"topic": "test_topic", "timestamp": 12346, "key": "11", "value": {"val": 1}},
        {"topic": "test_topic", "timestamp": 11345, "key": "10", "value": {"val": 2}},
        {"topic": "test_topic", "timestamp": 12345, "key": "10", "value": {"val": 2}},
        {"topic": "test_topic", "timestamp": 12366, "key": "9", "value": {"val": 3}},
        {"topic": "test_topic", "timestamp": 12367, "key": "8", "value": {"val": 4}},
        {"topic": "test_topic", "timestamp": 14367, "key": "8", "value": {"val": 4}},
        {"topic": "test_topic", "timestamp": 15367, "key": "8", "value": {"val": 4}},
        {"topic": "test_topic", "timestamp": 12368, "key": "12", "value": {"val": 5}},
        {"topic": "test_topic", "timestamp": 13368, "key": "12", "value": {"val": 5}},
        {"topic": "test_topic", "timestamp": 16369, "key": "13", "value": {"val": 6}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["12", 13000, 14000,1]}},
          {"row":{"columns":["13", 16000, 17000,1]}},
          {"row":{"columns":["8", 14000, 15000,1]}},
          {"row":{"columns":["8", 15000, 16000,1]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` STRING KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":["12", 13000, 14000,1]}},
          {"row":{"columns":["8", 14000, 15000,1]}}
        ]}
      ]
    },
    {
      "name": "fail on unsupported query feature: where missing column from multi-column key",
      "statements": [
        "CREATE STREAM INPUT (ID INTEGER KEY, COL INT) WITH (kafka_topic='test_topic', format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COL, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID, COL;",
        "SELECT * FROM AGGREGATE WHERE ID = 10;"
      ],
      "properties": {
        "ksql.query.pull.table.scan.enabled":  false
      },
      "expectedError": {
        "type": "io.confluent.ksql.rest.entity.KsqlStatementErrorMessage",
        "message": "Multi-column sources must specify every key in the WHERE clause",
        "status": 400
      }
    },
    {
      "name": "Generalized WHERE: single column from multi-column key",
      "statements": [
        "CREATE STREAM INPUT (ID INTEGER KEY, COL INT) WITH (kafka_topic='test_topic', format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COL, COUNT(1) AS COUNT FROM INPUT GROUP BY ID, COL;",
        "SELECT * FROM AGGREGATE WHERE ID = 10;"
      ],
      "properties": {
        "ksql.query.pull.table.scan.enabled":  true
      },
      "inputs": [
        {"topic": "test_topic", "timestamp": 1582501512456, "key": 5, "value": {"col": 1}},
        {"topic": "test_topic", "timestamp": 1582501512456, "key": 5, "value": {"col": 2}},
        {"topic": "test_topic", "timestamp": 1582501512456, "key": 10, "value": {"col": 1}},
        {"topic": "test_topic", "timestamp": 1582501512456, "key": 10, "value": {"col": 2}},
        {"topic": "test_topic", "timestamp": 1582501512456, "key": 15, "value": {"col": 1}},
        {"topic": "test_topic", "timestamp": 1582501512456, "key": 15, "value": {"col": 2}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `COL` INTEGER KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10, 1, 1]}},
          {"row":{"columns":[10, 2, 1]}}
        ]}
      ]
    },
    {
      "name": "Generalized WHERE: single column from multi-column key - windowed",
      "statements": [
        "CREATE STREAM INPUT (ID INTEGER KEY, COL INT) WITH (kafka_topic='test_topic', format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COL, COUNT(1) AS COUNT FROM INPUT WINDOW TUMBLING(SIZE 1 SECOND) GROUP BY ID, COL;",
        "SELECT * FROM AGGREGATE WHERE ID = 10;",
        "SELECT * FROM AGGREGATE WHERE COL > 1;",
        "SELECT * FROM AGGREGATE WHERE COL = 1;"
      ],
      "properties": {
        "ksql.query.pull.table.scan.enabled":  true
      },
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": -1, "value": {"col": 1}},
        {"topic": "test_topic", "timestamp": 12345, "key": 10, "value": {"col": 1}},
        {"topic": "test_topic", "timestamp": 12445, "key": 10, "value": {"col": 2}},
        {"topic": "test_topic", "timestamp": 12545, "key": 10, "value": {"col": 2}},
        {"topic": "test_topic", "timestamp": 12345, "key": 11, "value": {"col": 1}},
        {"topic": "test_topic", "timestamp": 12445, "key": 11, "value": {"col": 1}},
        {"topic": "test_topic", "timestamp": 13445, "key": 11, "value": {"col": 1}},
        {"topic": "test_topic", "timestamp": 12345, "key": 50, "value": {"col": 1}},
        {"topic": "test_topic", "timestamp": 13345, "key": 50, "value": {"col": 2}},
        {"topic": "test_topic", "timestamp": 12345, "key": 101, "value": {"col": 1}},
        {"topic": "test_topic", "timestamp": 12345, "key": 75, "value": {"col": 1}},
        {"topic": "test_topic", "timestamp": 14345, "key": 75, "value": {"col": 2}},
        {"topic": "test_topic", "timestamp": 14445, "key": 75, "value": {"col": 2}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `COL` INTEGER KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10, 1, 12000, 13000, 1]}},
          {"row":{"columns":[10, 2, 12000, 13000, 2]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `COL` INTEGER KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[50, 2, 13000, 14000, 1]}},
          {"row":{"columns":[75, 2, 14000, 15000, 2]}},
          {"row":{"columns":[10, 2, 12000, 13000, 2]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `COL` INTEGER KEY, `WINDOWSTART` BIGINT KEY, `WINDOWEND` BIGINT KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[10, 1, 12000, 13000, 1]}},
          {"row":{"columns":[50, 1, 12000, 13000, 1]}},
          {"row":{"columns":[75, 1, 12000, 13000, 1]}},
          {"row":{"columns":[-1, 1, 12000, 13000, 1]}},
          {"row":{"columns":[11, 1, 12000, 13000, 2]}},
          {"row":{"columns":[11, 1, 13000, 14000, 1]}},
          {"row":{"columns":[101, 1, 12000, 13000, 1]}}
        ]}
      ]
    },
    {
      "name": "Generalized WHERE: key fetch plus additional filters",
      "statements": [
        "CREATE STREAM INPUT (ID INTEGER KEY, IGNORED INT) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT * FROM AGGREGATE WHERE ID IN (10, 11, 50, 101, 75) AND COUNT > 1;"
      ],
      "properties": {
        "ksql.query.pull.table.scan.enabled":  false
      },
      "inputs": [
        {"topic": "test_topic", "timestamp": 1582501512451, "key": -1, "value": {}},
        {"topic": "test_topic", "timestamp": 1582501512452, "key": 10, "value": {}},
        {"topic": "test_topic", "timestamp": 1582401512453, "key": 11, "value": {}},
        {"topic": "test_topic", "timestamp": 1582401512454, "key": 11, "value": {}},
        {"topic": "test_topic", "timestamp": 1582501512455, "key": 50, "value": {}},
        {"topic": "test_topic", "timestamp": 1582501552456, "key": 101, "value": {}},
        {"topic": "test_topic", "timestamp": 1582501552457, "key": 101, "value": {}},
        {"topic": "test_topic", "timestamp": 1582501552458, "key": 101, "value": {}},
        {"topic": "test_topic", "timestamp": 1582501512459, "key": 75, "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `COUNT` BIGINT"}},
          {"row":{"columns":[11, 2]}},
          {"row":{"columns":[101, 3]}}
        ]}
      ]
    },
    {
      "name": "lambdas - lambda use in SELECT",
      "statements": [
        "CREATE STREAM INPUT (ID ARRAY<INTEGER> KEY, IGNORED INT) WITH (kafka_topic='test_topic', format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, COUNT(1) AS COUNT FROM INPUT GROUP BY ID;",
        "SELECT ID, COUNT, REDUCE(ID, 0, (x,y) => x + y) as sum FROM AGGREGATE;",
        "SELECT ID, COUNT, TRANSFORM(ID, x => 2 * x) as doubled FROM AGGREGATE;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": [1, 2], "value": {}},
        {"topic": "test_topic", "timestamp": 12365, "key": [3, 4], "value": {}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` ARRAY<INTEGER> KEY, `COUNT` BIGINT, `SUM` INTEGER"}},
          {"row":{"columns":[[3, 4], 1, 7]}},
          {"row":{"columns":[[1, 2], 1, 3]}}
        ]},
        {"query": [
          {"header":{"schema":"`ID` ARRAY<INTEGER> KEY, `COUNT` BIGINT, `DOUBLED` ARRAY<INTEGER>"}},
          {"row":{"columns":[[3, 4], 1, [6, 8]]}},
          {"row":{"columns":[[1, 2], 1, [2, 4]]}}
        ]}
      ]
    },
    {
      "name": "lambdas - lambda use in WHERE",
      "statements": [
        "CREATE STREAM INPUT (ID INTEGER KEY, VAL INTEGER) WITH (kafka_topic='test_topic', format='JSON');",
        "CREATE TABLE AGGREGATE AS SELECT ID, count(1) as COUNT, COLLECT_LIST(VAL) as VAL_LIST FROM INPUT GROUP BY ID;",
        "SELECT ID, count, VAL_LIST FROM AGGREGATE WHERE REDUCE(VAL_LIST, 0, (x,y) => x + y) > 4;"
      ],
      "inputs": [
        {"topic": "test_topic", "timestamp": 12345, "key": 1, "value": {"val": 1}},
        {"topic": "test_topic", "timestamp": 12365, "key": 1, "value": {"val": 2}},
        {"topic": "test_topic", "timestamp": 12345, "key": 1, "value": {"val": 3}},
        {"topic": "test_topic", "timestamp": 12345, "key": 2, "value": {"val": 1}},
        {"topic": "test_topic", "timestamp": 12365, "key": 2, "value": {"val": 2}},
        {"topic": "test_topic", "timestamp": 12365, "key": 3, "value": {"val": 5}}
      ],
      "responses": [
        {"admin": {"@type": "currentStatus"}},
        {"admin": {"@type": "currentStatus"}},
        {"query": [
          {"header":{"schema":"`ID` INTEGER KEY, `COUNT` BIGINT, `VAL_LIST` ARRAY<INTEGER>"}},
          {"row":{"columns":[1, 3, [1, 2, 3]]}},
          {"row":{"columns":[3, 1, [5]]}}
        ]}
      ]
    },
    {
      "name": "should give good error message when querying with duplicate column values",
      "statements": [
        "CREATE TABLE INPUT (ID INTEGER PRIMARY KEY, VAL VARCHAR) with (kafka_topic='test_topic', format='json', partitions=1);",
        "SELECT VAL, VAL FROM INPUT WHERE ID = 10;"
      ],
      "expectedError": {
        "type": "io.confluent.ksql.rest.entity.KsqlStatementErrorMessage",
        "message": "Duplicate value columns found in schema: `VAL` STRING",
        "status": 400
      }
    }
  ]
}